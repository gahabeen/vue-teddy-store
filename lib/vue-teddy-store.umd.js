!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@vue/composition-api")):"function"==typeof define&&define.amd?define(["@vue/composition-api"],e):(t=t||self).VueTeddyStore=e(t.compositionApi)}(this,(function(t){"use strict";var e=Object.freeze(["Couldn't not find any proper value for ",""]),r=/({.+?})/gim;function n(t){return function(r){var n=o(t,r.slice(1,-1).trim());if(["string","number"].includes(typeof n))return n;throw new Error(e,n)()}}function o(t,e,o,i){return String(e).replace(/\[/g,".").replace(/]/g,"").replace(r,n(i)).split(".").reduce((function(t,e){try{t=void 0===t[e]?o:t[e]}catch(t){return o}return t}),t)}var i=function(t){return"teddy:store:"+t},s={handle:function(e){var r,n,o,s=e.name,a=e.store,c=window.localStorage||global.localStorage||{};if(c){var u=c.getItem(i(s));u&&(a._state=Object.assign({},a._state,JSON.parse(u))),t.watch(a._state,(r=function(t,e){t!==e&&c.setItem(i(s),JSON.stringify(t))},void 0===(n=500)&&(n=100),function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];clearTimeout(o),o=setTimeout((function(){r.apply(t,e)}),n)}),{immediate:!0,deep:!0})}}},a={handle:function(e){var r=e.store;r._history=t.reactive([]),t.watch(r._state,(function(t){r._history.push(t)}),{immediate:!0,deep:!0})}},c={handle:function(e){var r=e.name,n=e.store;window&&window.addEventListener("storage",(function(e){e.key===i(r)&&(n._state=t.reactive(Object.assign({},n._state,JSON.parse(e.newValue))))}))}};function u(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(r[n]=t[n]);return r}function f(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=t.find((function(t){return t&&t instanceof p})),n=t.find((function(t){return t&&"$teddy"in t&&t.$teddy instanceof p})),o=r||(n?n.$teddy:void 0);if(!o)throw new Error("Couldn't find any proper instance!");return o}var p=function(){this._stores=t.reactive({}),this._plugins=t.reactive({cache:s,history:a,sync:c})},h={stores:{configurable:!0}};return p.prototype.add=function(e,r){var n,i=this,s=(r._state,r.state,r.methods,r.watchers,u(r,["_state","state","methods","watchers"])),a=p.createState(r._state||r.state||{}),c=a._state,f=a.state;this._stores=Object.assign({},this._stores,((n={})[e]=t.reactive(Object.assign({},{_state:c,state:f},r.methods||{},s)),n));var h=[];for(var d of(Array.isArray(r.watchers)?h.push.apply(h,r.watchers):r.watcher&&h.push(r.watcher),h))if("function"==typeof d)t.watch(this._stores[e].state,d,{deep:!0});else if(d&&"object"==typeof d&&"handler"in d){var l=d.handler,y=d.path,v=d.paths;void 0===v&&(v=[]);var g=u(d,["handler","path","paths"]);y?t.watch((function(){return o(i._stores[e].state,y)}),l,Object.assign({},{deep:!0},g)):v.length>0?t.watch(v.map((function(t){return function(){return o(i._stores[e].state,t)}})),l,Object.assign({},{deep:!0},g)):t.watch((function(){return i._stores[e].state}),l,Object.assign({},{deep:!0},g))}return this},p.prototype.use=function(t){var e=this;return void 0===t&&(t={}),"function"==typeof t.install&&t.install(this),"function"==typeof t.handle&&Object.keys(this._stores).map((function(r){return t.handle.call(e,{name:r,store:e._stores[r]})})),this},p.prototype.activate=function(t){for(var e of(void 0===t&&(t=[]),Array.isArray(t)||(t=[t]),t))e in this._plugins&&this.use(this._plugins[e]);return this},p.prototype.install=function(t){t.prototype.$Teddy=p,t.prototype.$teddy=this},h.stores.get=function(){return this._stores},p.createState=function(e){void 0===e&&(e={});var r=t.isRef(e)?e:t.ref(e),n=t.computed((function(){return r.value}));return{_state:r,state:n}},p.prototype.get=function(t,e){return p.get.call(this,t,e)},p.get=function(t,e,r){return r=r||this,function(){var n=f(this,r);try{return o(n.stores[t].state,e,void 0,r)}catch(r){throw new Error("Couldn't compute (get) path '"+e+"' for '"+t+"'")}}},p.prototype.set=function(t,e){return p.set.call(this,t,e)},p.set=function(t,e,o){return o=o||this,function(i){var s=f(this,o);try{!function(t,e,o,i){var s=String(e).replace(/\[/g,".").replace(/]/g,"").replace(r,n(i)).split("."),a=function(t){return t.replace(/^\^/,"")},c=function(t,e,r){var n=e.shift();if(e.length>0){if(Number.isInteger(+e[0]))return t[n]=[],c(t[n],e,r);if(!t[n])return t[a(n)]={},c(t[a(n)],e,r)}else t[a(n)]=r};c(t,s,o)}(s.stores[t]._state,e,i,o)}catch(r){throw new Error("Couldn't compute (set) path '"+e+"' for '"+t+"'")}}},p.prototype.compute=function(t,e){return p.compute.call(this,t,e)},p.compute=function(t,e){return{get:p.get.call(this,t,e),set:p.set.call(this,t,e)}},Object.defineProperties(p.prototype,h),p}));
