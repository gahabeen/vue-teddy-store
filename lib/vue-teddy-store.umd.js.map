{"version":3,"file":"vue-teddy-store.umd.js","sources":["../src/install/vue-composition-api.js","../src/utils.js","../src/plugins/cache.js","../src/plugins/history.js","../src/plugins/sync.js","../src/index.js"],"sourcesContent":["import Vue from \"vue\";\r\nimport VueCompositionApi from \"@vue/composition-api\";\r\nVue.use(VueCompositionApi);\r\n","const VARIABLE_PATH = /({.+?})/gim\r\n\r\nfunction resolvePath(instance) {\r\n  return (path) => {\r\n    const variablePath = get(instance, path.slice(1, -1).trim())\r\n    if (['string', 'number'].includes(typeof variablePath)) {\r\n      return variablePath\r\n    } else {\r\n      /* istanbul ignore next */\r\n      throw new Error`Couldn't not find any proper value for ${variablePath}`()\r\n    }\r\n  }\r\n}\r\n\r\nexport function isComputed(obj) {\r\n  if (!obj || typeof obj !== 'object' || !('value' in obj)) return false\r\n  const desc = Object.getOwnPropertyDescriptor(obj, 'value')\r\n  return typeof desc.get === 'function' && typeof desc.set === 'function'\r\n}\r\n\r\nexport function omit(obj, keys = []) {\r\n  return Object.keys(obj).reduce((acc, key) => {\r\n    if (!key.includes(keys)) {\r\n      acc[key] = obj[key]\r\n    }\r\n    return acc\r\n  }, {})\r\n}\r\n\r\nexport function debounce(fn, wait = 100) {\r\n  let timeout\r\n  return function(...args) {\r\n    clearTimeout(timeout)\r\n    timeout = setTimeout(() => {\r\n      fn.apply(this, args)\r\n    }, wait)\r\n  }\r\n}\r\n\r\nexport function hasProp(obj, key) {\r\n  if (!obj || typeof obj !== 'object') return\r\n  if (isComputed(obj) && key in obj.value) {\r\n    return true\r\n  } else if (key in obj) {\r\n    return true\r\n  } else {\r\n    return false\r\n  }\r\n}\r\n\r\nexport function getProp(obj, key) {\r\n  if (isComputed(obj) && key in obj.value) {\r\n    return obj.value[key]\r\n  } else if (key in obj) {\r\n    return obj[key]\r\n  }\r\n}\r\n\r\nexport function setProp(obj, key, value) {\r\n  if (isComputed(obj) && key in obj.value) {\r\n    obj.value[key] = value\r\n    return obj.value[key]\r\n  } else {\r\n    obj[key] = value\r\n    return obj[key]\r\n  }\r\n}\r\n\r\nexport function get(obj, path, defaultValue, instance) {\r\n  const steps = String(path)\r\n    .replace(/\\[/g, '.')\r\n    .replace(/]/g, '')\r\n    .replace(VARIABLE_PATH, resolvePath(instance))\r\n    .split('.')\r\n\r\n  function _get(item, steps, fallback) {\r\n    if (steps.length > 0) {\r\n      const step = steps.shift()\r\n      const stepValue = getProp(item, step) || fallback\r\n      // console.log(\"_get stepValue\", stepValue);\r\n      return _get(stepValue, steps, fallback)\r\n    } else {\r\n      // console.log(\"_get\", item);\r\n      return item\r\n    }\r\n  }\r\n\r\n  return _get(obj, steps, defaultValue)\r\n}\r\n\r\nexport function set(obj, path, value, instance) {\r\n  const steps = String(path)\r\n    .replace(/\\[/g, '.')\r\n    .replace(/]/g, '')\r\n    .replace(VARIABLE_PATH, resolvePath(instance))\r\n    .split('.')\r\n\r\n  const cleanStep = (key) => key.replace(/^\\^/, '')\r\n\r\n  const _set = (item, steps, val) => {\r\n    const step = steps.shift()\r\n    if (steps.length > 0) {\r\n      if (Number.isInteger(+steps[0])) {\r\n        return _set(setProp(item, step, []), steps, val)\r\n      } else if (!hasProp(item, cleanStep(step))) {\r\n        // To force an integer as an object property, prefix it with ^\r\n        // If somehow you want to have a ^ in a key name, double it ^^\r\n        return _set(setProp(item, cleanStep(step), {}), steps, val)\r\n      } else {\r\n        return _set(getProp(item, cleanStep(step)), steps, val)\r\n      }\r\n    } else {\r\n      setProp(item, cleanStep(step), val)\r\n    }\r\n  }\r\n\r\n  if (steps.length > 0) {\r\n    _set(obj, steps, value)\r\n  } else {\r\n    // hmm\r\n    if (obj.value) {\r\n      obj.value = value\r\n    } else {\r\n      obj = value\r\n    }\r\n  }\r\n\r\n  return obj\r\n}\r\n","import { watch } from '@vue/composition-api'\r\n// import { debounce } from '../utils'\r\n\r\nexport const prefix = (name) => `teddy:store:${name}`\r\nexport default {\r\n  handle({ name, store }) {\r\n    /* istanbul ignore next */\r\n    const localStorage = window.localStorage || global.localStorage || {}\r\n    /* istanbul ignore next */\r\n    if (localStorage) {\r\n      // Fetched saved state when exists\r\n      // const cached = localStorage.getItem(prefix(name))\r\n      // if (cached) store._state = { ...store._state, ...JSON.parse(cached) }\r\n      // Watch for mutations, save them\r\n      watch(\r\n        () => store._state,\r\n        (newState, oldState) => {\r\n          console.log('caching', newState)\r\n          if (newState !== oldState) {\r\n            localStorage.setItem(prefix(name), JSON.stringify(newState))\r\n          }\r\n        },\r\n        { immediate: true, deep: true }\r\n      )\r\n    }\r\n  },\r\n}\r\n","import { reactive, watch } from '@vue/composition-api'\r\n\r\nexport default {\r\n  handle({ store }) {\r\n    store._history = reactive([])\r\n    watch(\r\n      store._state,\r\n      (newState) => {\r\n        store._history.push(newState)\r\n      },\r\n      { immediate: true, deep: true }\r\n    )\r\n  },\r\n}\r\n","import { reactive } from '@vue/composition-api'\r\nimport { prefix } from './cache'\r\n\r\nexport default {\r\n  handle({ name, store }) {\r\n    /* istanbul ignore next */\r\n    if (window) {\r\n      window.addEventListener('storage', (e) => {\r\n        if (e.key === prefix(name)) {\r\n          store._state = reactive({ ...store._state, ...JSON.parse(e.newValue) })\r\n        }\r\n      })\r\n    }\r\n  },\r\n}\r\n","import './install/vue-composition-api'\r\nimport { computed, watch, ref, isRef, isReactive, toRefs } from '@vue/composition-api'\r\n\r\nimport * as utils from './utils'\r\n\r\nimport CachePlugin from './plugins/cache'\r\nimport HistoryPlugin from './plugins/history'\r\nimport SyncPlugin from './plugins/sync'\r\n\r\nfunction getInstance(...solutions) {\r\n  const instanceSolution = solutions.find((s) => s && s instanceof TeddyStore)\r\n  const contextSolution = solutions.find((s) => s && '$teddy' in s && s.$teddy instanceof TeddyStore)\r\n  const solution = instanceSolution || (contextSolution ? contextSolution.$teddy : undefined)\r\n  if (!solution) {\r\n    /* istanbul ignore next */\r\n    throw new Error(`Couldn't find any proper instance!`)\r\n  }\r\n  return solution\r\n}\r\n\r\nexport default class TeddyStore {\r\n  constructor() {\r\n    this._stores = {}\r\n    this._plugins = {\r\n      cache: CachePlugin,\r\n      history: HistoryPlugin,\r\n      sync: SyncPlugin,\r\n    }\r\n  }\r\n\r\n  add(name, store) {\r\n    // eslint-disable-next-line no-unused-vars\r\n    const others = utils.omit(store, ['_state', 'state', 'methods', 'watchers'])\r\n\r\n    const states = TeddyStore.createState(store._state || store.state || {})\r\n    this._stores[name] = ref({\r\n      ...states,\r\n      ...(store.methods || {}),\r\n      ...others,\r\n    })\r\n\r\n    const watchers = []\r\n    if (Array.isArray(store.watchers)) {\r\n      watchers.push(...store.watchers)\r\n    } else if (store.watcher) {\r\n      watchers.push(store.watcher)\r\n    }\r\n\r\n    for (let watcher of watchers) {\r\n      if (typeof watcher === 'function') {\r\n        watch(() => this._stores[name].value.state.value, watcher, { deep: true })\r\n      } else if (watcher && typeof watcher === 'object' && 'handler' in watcher) {\r\n        const { handler, path, paths = [], ...options } = watcher\r\n        if (path) {\r\n          watch(() => utils.get(this._stores[name].value.state.value, path), handler, { deep: true, ...options })\r\n        } else if (paths.length > 0) {\r\n          watch(\r\n            paths.map((p) => () => utils.get(this._stores[name].value.state.value, p)),\r\n            handler,\r\n            { deep: true, ...options }\r\n          )\r\n        } else {\r\n          watch(() => this._stores[name].value.state.value, handler, { deep: true, ...options })\r\n        }\r\n      }\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  use(plugin = {}) {\r\n    if (typeof plugin.install === 'function') {\r\n      plugin.install(this)\r\n    }\r\n    if (typeof plugin.handle === 'function') {\r\n      Object.keys(this._stores).map((name) => plugin.handle.call(this, { name, store: this._stores[name] }))\r\n    }\r\n    return this\r\n  }\r\n\r\n  activate(pluginNames = []) {\r\n    if (!Array.isArray(pluginNames)) pluginNames = [pluginNames]\r\n    for (let pluginName of pluginNames) {\r\n      if (pluginName in this._plugins) {\r\n        this.use(this._plugins[pluginName])\r\n      }\r\n    }\r\n    return this\r\n  }\r\n\r\n  install(VueInstance) {\r\n    VueInstance.prototype.$Teddy = TeddyStore\r\n    VueInstance.prototype.$teddy = this\r\n  }\r\n\r\n  get stores() {\r\n    return this._stores\r\n  }\r\n\r\n  static createState(newState) {\r\n    const _state = isReactive(newState) ? toRefs(newState) : isRef(newState) ? newState : ref(newState)\r\n    // /* Until it's made available by Vue 3, be careful with { state } as it can be deeply mutable*/\r\n    // // const state = readonly(() => _state.value)\r\n    const state = computed(() => _state.value)\r\n    return { _state, state }\r\n  }\r\n\r\n  get(name, path) {\r\n    return TeddyStore.get(name, path, this)\r\n  }\r\n\r\n  set(name, path) {\r\n    return TeddyStore.set(name, path, this)\r\n  }\r\n\r\n  static get(name, path, context) {\r\n    context = context || this\r\n    return function get() {\r\n      const _instance = getInstance(this, context)\r\n      const value = utils.get(_instance, `stores.${name}.value.state.value.${path}`, undefined, context)\r\n      // console.log('get', path, _instance, value)\r\n      // console.log('isComputed', utils.isComputed(_instance.stores.user.value.state))\r\n      // watch(\r\n      //   () => _instance.stores.user.value,\r\n      //   (newState) => {\r\n      //     console.log('newState value', newState)\r\n      //   },\r\n      //   { deep: true }\r\n      // )\r\n      // _instance.stores.user.value._state.value.profile.firsName = 'Teddys'\r\n\r\n      // return _instance.stores.user.value._state.value.profile\r\n      // console.log(\"get\", _instance.stores.user.value._state.value);\r\n      return value\r\n    }\r\n  }\r\n\r\n  static set(name, path, context) {\r\n    context = context || this\r\n    return function set(value) {\r\n      console.log('set')\r\n      const _instance = getInstance(this, context)\r\n      utils.set(_instance, `stores.${name}._state.${path}`, value, context)\r\n      // console.log(\"_instance.stores.user.value._state.value.profile\", _instance.stores.user.value._state.value.profile);\r\n    }\r\n  }\r\n\r\n  compute(name, path) {\r\n    return TeddyStore.compute(name, path, this)\r\n  }\r\n\r\n  static compute(name, path, context) {\r\n    context = context || this\r\n    const get = TeddyStore.get(name, path, context)\r\n    const set = TeddyStore.set(name, path, context)\r\n    // return computed({\r\n    //   get() {\r\n    //     const _instance = getInstance(this, context)\r\n    //     const value = utils.get(_instance, `stores.${name}.state.${path}`, undefined, context)\r\n    //     console.log('value', value)\r\n    //     return value\r\n    //   },\r\n    //   set(value) {\r\n    //     console.log(\"set\", name, path, value);\r\n    //     const _instance = getInstance(this, context)\r\n    //     utils.set(_instance, `stores.${name}._state.${path}`, value, context)\r\n    //     console.log(\"get the value\", utils.get(_instance, `stores.${name}.state.${path}`, undefined, context));\r\n    //   },\r\n    // })\r\n    return computed({ get, set })\r\n  }\r\n\r\n  // static compute(name, path, context) {\r\n  //   context = context || this\r\n  //   if (typeof path === 'object') {\r\n  //     return Object.keys(path).reduce((acc, key) => {\r\n  //       acc[key] = TeddyStore._compute(name, path[key], context)\r\n  //       return acc\r\n  //     }, {})\r\n  //   } else {\r\n  //     return TeddyStore._compute(name, path, context)\r\n  //   }\r\n  // }\r\n}\r\n"],"names":["VueCompositionApi","const","watch","reactive","utils.omit","ref","let","this","utils.get","isReactive","toRefs","isRef","computed","get","set","utils.set"],"mappings":"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"}