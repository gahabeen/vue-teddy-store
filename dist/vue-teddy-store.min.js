/*!
  * vue-teddy-store v0.1.34
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.1.34
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
var VueTeddyStore=function(t,e,s,r){"use strict";function o(t){if(!e.isObject(t)||e.isObject(t)&&!("value"in t))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(t,"value").get}function i(t){return t.filter(Boolean).filter(t=>t.length>0).join(".")}function n(t,s,r){return e.isValidKey(s)&&(e.isObject(t)||Array.isArray(t))?o(t)&&"value"in t&&s in t.value?(t.value[s]=r,t.value[s]):(t[s]=r,t[s]):t&&null==s?(o(t)&&"value"in t?t.value=r:e.isObject(r)?Object.assign(t,r):t=r,t):void console.log("Couldn't not set "+s)}function a(t,s){return e.isValidKey(s)?o(t)?s in t.value?t.value[s]:t.value:e.isObject(t)||Array.isArray(t)?t[s]:void 0:t&&void 0===s?o(t)?t.value:t:void 0}function c(t,s){return!(!e.isObject(t)&&!Array.isArray(t))&&(!!e.isValidKey(s)&&(!!(o(t)&&t.value&&s in t.value)||(!(!t||!(s in t))||void 0)))}function h(t){return e=>{const[s,...r]=e||[];return s?(t(s),["_stores",s,"state",...r]):[]}}r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;const u=(t=(t=>t))=>e.makeSet({setProp:n,getProp:a,hasProp:c,afterGetSteps:h(t)}),d=(t=(t=>t))=>e.makeHas({getProp:a,hasProp:c,afterGetSteps:h(t)}),l=(t=(t=>t))=>e.makeGet({getProp:a,hasProp:c,afterGetSteps:h(t)}),p=e.makeSet({setProp:n,getProp:a,hasProp:c}),f=e.makeHas({getProp:a,hasProp:c}),y=e.makeGet({getProp:a,hasProp:c});var g=Object.freeze({__proto__:null,makeTeddySet:u,makeTeddyHas:d,makeTeddyGet:l,set:p,has:f,get:y});const _=t=>"teddy:store:"+t;var v={handle({name:t,store:e}){const r=window.localStorage||global.localStorage||{};if(r){const o=r.getItem(_(t));o&&(e.state={...e.state,...JSON.parse(o)}),s.watch(()=>e.state,(e,s)=>{e!==s&&r.setItem(_(t),JSON.stringify(e))},{immediate:!0,deep:!0})}}},m={handle({store:t}){t._history=s.reactive([]),s.watch(t.state,e=>{t._history.push(e)},{immediate:!0,deep:!0})}},b={handle({name:t,store:e}){window&&window.addEventListener("storage",s=>{s.key===_(t)&&(e.state={...e.state,...JSON.parse(s.newValue)})})}},w=Object.freeze({__proto__:null,cache:v,history:m,sync:b});let O;class P extends Error{constructor(t){super(t),this.name="MissingStoreError"}}class j{constructor(t){this._options={devtools:r.config.devtools,...t||{}},this._vueInstance=null,this._stores={},this._features=w}add(t,e){return e=e||{},this._stores[t]={},this[t]=this._stores[t],this.addState(t,e.state),this.addGetters(t,e.getters),this.addActions(t,e.actions),this.addStoreProperties(t,function(t,e=[]){return Object.keys(t).reduce((s,r)=>(e.includes(r)||(s[r]=t[r]),s),{})}(e,["state","getters","actions","watcher","watchers","devtools"])),this.registerWatchers(t,e.watcher),this.registerWatchers(t,e.watchers),this}addStoreProperties(t,e,s){const{allowOverriding:r=!1,alsoAtPath:o=null}=s||{};this._stores[t]||(this._stores[t]={});for(const s of Object.keys(e||{}))!(s in this._stores[t])||r?(this._stores[t][s]=e[s],"string"==typeof o&&(this._stores[t][o]||(this._stores[t][o]={}),this._stores[t][o][s]=this._stores[t][s])):console.warn(`addStoreProperties('${t}',...) - Couldn't override property ${s} on store '${t}'`);return this}addState(t,e){this._stores[t]||(this._stores[t]={});const s=S(e);return this._stores[t]._state=s,Object.defineProperty(this._stores[t],"state",{get:()=>s.value,set:t=>{s.value=t},enumerable:!0}),this}addGetters(t,e){return this.addStoreProperties(t,A(this._stores[t],e),{alsoAtPath:"_getters"}),this}addActions(t,e){return this.addStoreProperties(t,k(this._stores[t],e),{alsoAtPath:"_actions"}),this}registerWatchers(t,e){const r=[];if(Array.isArray(e)?r.push(...e):e&&r.push(e),this.exists(t)&&0!==r.length){for(let e of r)if("function"==typeof e)s.watch(()=>this._stores[t].state,e,{deep:!0});else if(e&&"object"==typeof e&&"handler"in e){const{handler:r,path:o,paths:n=[],...a}=e;"string"==typeof o?(console.log(">> register watcher",o,l()(this,i([t,o]))),s.watch(()=>l()(this,i([t,o])),r,{deep:!0,...a})):n.length>0?s.watch(n.map(e=>()=>l()(this,i([t,e]))),r,{deep:!0,...a}):s.watch(()=>this._stores[t].state,r,{deep:!0,...a})}return this}}exists(t){return t in this._stores}remove(t){t in this&&delete this[t],t in this._stores&&delete this._stores[t]}reset(){for(let t in this._stores)this.remove(t)}use(t={}){return"function"==typeof t.install&&t.install(this),"function"==typeof t.handle&&Object.keys(this._stores).map(e=>t.handle.call(this,{name:e,store:this._stores[e]})),this}activate(t=[]){Array.isArray(t)||(t=[t]);for(let e of t)e in this._features&&this.use(this._features[e]);return this}attachTo(t){return this._vueInstance=t,this}install(...t){const e=this,[s]=t;if(s.version.startsWith("2")){if(O&&s===O)return;O=s,Object.defineProperty(s.prototype,"$teddy",{get(){return e.attachTo(this)},enumerable:!0,configurable:!0})}else if(s.version.startsWith("3")){const[s]=t;s.provide("$teddy"),Object.defineProperty(s.config.globalProperties,"$teddy",{get(){return e.attachTo(this)},configurable:!0})}}get stores(){return this._stores}has(t,e){return $(t,e)}get(t,e){return x(t,e)}getter(t,e){return T(t,e)}set(t,e,s){return G(t,e,s)}setter(t,e){return E(t,e)}sync(t,e){return I(t,e)}computed(t){return V(t)}}const S=(t={})=>s.isRef(t)?t:s.ref(t),A=(t,e)=>(e=e||{},Object.keys(e).reduce((s,r)=>{if(o(e[r]))s[r]=e[r];else if("function"==typeof e[r]){const o={state:t.state,getters:t.getters};s[r]=V(()=>e[r](o))}return s},{})),k=(t,e)=>(e=e||{},Object.keys(e).reduce((s,r)=>{if("function"==typeof e[r]){const o={state:t.state,getters:t.getters};s[r]=(...t)=>e[r](o,...t)}return s},{})),$=(t,e)=>{const s=O.prototype.$teddy;return d(e=>{if(!s.exists(e))throw new P(`You're trying to use the method .has('${t}', context?) on a store which doesn't exists: '${e}'`)})(s,t,W(e,s))},x=(t,e)=>{const s=O.prototype.$teddy;return l(e=>{if(!s.exists(e))throw new P(`You're trying to use the method .get('${t}', context?) on a store which doesn't exists: '${e}'`)})(s,t,W(e,s))},G=(t,e,s)=>{const r=O.prototype.$teddy;u(e=>{if(!r.exists(e))throw new P(`You're trying to use the method .set('${t}', value, context?) on a store which doesn't exists: '${e}'`)})(r,t,e,W(s,r))},T=(t,e)=>function(){return x(t,e)},E=(t,e)=>function(s){G(t,s,e)},I=(t,s)=>{const r=(t,e)=>({get:T(t,e),set:E(t,e)});return Array.isArray(t)?t.reduce((t,e)=>(t[e]=r(e,s),t),{}):e.isObject(t)?Object.keys(t).reduce((e,o)=>(e[o]=r(t[o],s),e),{}):r(t,s)},V=t=>{if(e.isObject(t)){const e="get"in t&&"function"==typeof t.get,r="set"in t&&"function"==typeof t.set;return e||r?s.computed(t):Object.keys(t).reduce((e,r)=>(e[r]=s.computed(t[r]),e),{})}return s.computed(t)};function W(...t){return t.filter(Boolean).reduce((t,s)=>s instanceof j&&s._vueInstance?s._vueInstance:e.isObject(s)?s:t,{})}var C=Object.freeze({__proto__:null,MissingStoreError:P,default:j,createState:S,createGetters:A,createActions:k,has:$,get:x,set:G,getter:T,setter:E,sync:I,computed:V,resolveContext:W});const{has:M,get:z,set:H,sync:J,computed:K,setter:N,getter:Y,createGetters:B,createState:D,MissingStoreError:L}=C;return t.MissingStoreError=L,t.accessors=g,t.computed=K,t.createGetters=B,t.createState=D,t.default=j,t.get=z,t.getter=Y,t.has=M,t.set=H,t.setter=N,t.sync=J,t}({},objectStringPath,vueCompositionApi,Vue);
