/*!
  * vue-teddy-store v0.1.24
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.1.24
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
var VueTeddyStore=function(t){"use strict";const e=t=>"teddy:store:"+t;var r={handle({name:r,store:n}){const s=window.localStorage||global.localStorage||{};if(s){const i=s.getItem(e(r));i&&(n.state={...n.state,...JSON.parse(i)}),t.watch(n.state,(t,n)=>{t!==n&&s.setItem(e(r),JSON.stringify(t))},{immediate:!0,deep:!0})}}},n={handle({store:e}){e._history=t.reactive([]),t.watch(e.state,t=>{e._history.push(t)},{immediate:!0,deep:!0})}},s={handle({name:r,store:n}){window&&window.addEventListener("storage",s=>{s.key===e(r)&&(n.state=t.reactive({...n.state,...JSON.parse(s.newValue)}))})}},i=Object.freeze({__proto__:null,cache:r,history:n,sync:s});const o=/({.+?})/gim,a=/('.+?')/gim;function c(t,e){return r=>{const n=r.replace(/>/gim,".").slice(1,-1).trim();if(n.includes(":")){const r=n.split(":").filter(Boolean).map(t=>t.trim()).map(r=>r.match(a)?r.slice(1,-1).trim():c(t,e)(`{${r}}`));if(2===r.length){const[t,s]=r,i=function(t,e,r){for(let n of Object.keys(t))if(u(t[n])&&t[n][e]==r)return n}(e,t,s);if(void 0!==i)return i;throw new Error(`Couldn't not find any proper variablePath for ${n} and ${r}`)}throw new Error("Couldn't not find any proper keyValue for "+n)}{const e=p(t,n);if(["string","number"].includes(typeof e))return e;throw new Error(`Couldn't not find any proper value for ${e} at ${n}`)}}}function u(t){let e,r;function n(t){return"[object Object]"===Object.prototype.toString.call(t)}return!1!==n(t)&&(e=t.constructor,void 0===e||(r=e.prototype,!1!==n(r)))}function l(t){if(!u(t)||u(t)&&!("value"in t))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(t,"value").get}function h(t,e){return!(!u(t)&&!Array.isArray(t))&&(!(!l(t)||!(e in t.value))||e in t)}function f(t,e){if(u(t)||Array.isArray(t))return l(t)?e&&e in t.value?t.value[e]:t.value:e&&e in t?t[e]:t}function p(t,e,r){return function t(e,n){if(!(n.length>0))return e;{const s=n.shift().replace(o,c(r,e));if(h(e,s)){return t(f(e,s),n)}}}(t,String(e).replace(/\[/g,".").replace(/]/g,"").replace(o,(function(t){return t.replace(/\./gim,">")})).split("."))}function d(t,e,r){return l(t)&&e in t.value?(t.value[e]=r,t.value[e]):(t[e]=r,t[e])}function g(t){const e=t.filter(t=>t&&u(t)&&t instanceof w),r=t.filter(t=>t&&u(t)&&"$teddy"in t&&t.$teddy instanceof w),n=t.filter(t=>!e.includes(t)&&!r.includes(t));return{instances:e,hosted:r,others:n}}function y(...t){const{instances:e,hosted:r}=g(t),n=[...e,...r.map(t=>t.$teddy)];if(0===!e.length)throw new Error("Couldn't find any proper instance!");return n[0]}function m(...t){const{hosted:e,others:r}=g(t),n=[...e,...r];if(0===!n.length)throw new Error("Couldn't find any proper context!");return n[0]}class w{constructor(){this._stores={},this._plugins=i}add(e,r){const n=function(t,e=[]){return Object.keys(t).reduce((r,n)=>(n.includes(e)||(r[n]=t[n]),r),{})}(r,["state","methods","watchers"]);this._stores[e]={...w.createState(r.state),...r.methods||{},...n},this[e]=this._stores[e];const s=[];Array.isArray(r.watchers)?s.push(...r.watchers):r.watcher&&s.push(r.watcher);for(let r of s)if("function"==typeof r)t.watch(()=>this._stores[e].state.value,r,{deep:!0});else if(r&&"object"==typeof r&&"handler"in r){const{handler:n,path:s,paths:i=[],...o}=r;s?t.watch(()=>p(this._stores[e].state.value,s),n,{deep:!0,...o}):i.length>0?t.watch(i.map(t=>()=>p(this._stores[e].state.value,t)),n,{deep:!0,...o}):t.watch(()=>this._stores[e].state.value,n,{deep:!0,...o})}return this}remove(t){t in this&&delete this[t],t in this._stores&&delete this._stores[t]}use(t={}){return"function"==typeof t.install&&t.install(this),"function"==typeof t.handle&&Object.keys(this._stores).map(e=>t.handle.call(this,{name:e,store:this._stores[e]})),this}activate(t=[]){Array.isArray(t)||(t=[t]);for(let e of t)e in this._plugins&&this.use(this._plugins[e]);return this}install(t){t.prototype.$teddy=this}get stores(){return this._stores}static createState(e){return t.isRef(e)?e:t.ref(e)}get(t,e){return w.get(t,e,this)}static get(t,e,r){return p(y(this,r),`_stores.${t}.state.${e}`,m(this,r))}getter(t,e){return w.getter(t,e,this)}static getter(t,e,r){return r=r||this,function(){return w.get.call(this,t,e,r)}}set(t,e,r){return w.set(t,e,r,this)}static set(t,e,r,n){!function(t,e,r,n){const s=String(e).replace(/\[/g,".").replace(/]/g,"").replace(o,(function(t){return t.replace(/\./gim,">")})).split("."),i=(t,e,r)=>{const s=(a=e.shift(),a.replace(/^\^/,"")).replace(o,c(n,t));var a;if(e.length>0){const a=e[0].replace(o,c(n,f(t,s)));if(Number.isInteger(+a)){if(!h(t,s)||!Array.isArray(f(t,s)))return i(d(t,s,[]),e,r);i(f(t,s),e,r)}else{if(!h(t,s)||!u(f(t,s)))return i(d(t,s,{}),e,r);i(f(t,s),e,r)}}else d(t,s,r)};s.length>0?i(t,s,r):t.value?t.value=r:t=r}(y(this,n),`_stores.${t}.state.${e}`,r,m(this,n))}setter(t,e){return w.setter(t,e,this)}static setter(t,e,r){return r=r||this,function(n){w.set.call(this,t,e,n,r)}}compute(t,e){return w.compute(t,e,this)}static _compute(t,e,r){r=r||this;return{get:w.getter(t,e,r),set:w.setter(t,e,r)}}static compute(t,e,r){return r=r||this,u(e)?Object.keys(e).reduce((n,s)=>(n[s]=w._compute(t,e[s],r),n),{}):w._compute(t,e,r)}}return w}(vueCompositionApi);
