/*!
  * vue-teddy-store v0.2.7
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.2.7
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
var VueTeddyStore=function(e,t,s,r,n){"use strict";var o="default"in t?t.default:t;r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;const a=(e,t)=>`teddy:${e}:${t}`;var c={store(e,t){const s=pe({space:e,name:t});if(s.features.cache)return;const r=window.localStorage||global.localStorage||{};if(r){const n=r.getItem(a(e,t));n&&(s.state=JSON.parse(n)),B({space:e,name:t},{handler(s){r.setItem(a(e,t),JSON.stringify(s))},immediate:!0,deep:!0}),s.features.cache=!0}}},i={store(e,s){const r=pe({space:e,name:s});r.features.history||(r.features.history={},r.features.history.stack=t.reactive([]),B({space:e,name:s},{handler(e){r.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),r.features.history.installed=!0)}},u={store(e,t){const s=pe({space:e,name:t});s.features.sync||(s.features.sync={},window&&window.addEventListener("storage",r=>{r.key===a(e,t)&&(s.state={...s.state,...JSON.parse(r.newValue)})}),s.features.sync.installed=!0)}},p=Object.freeze({__proto__:null,cache:c,history:i,sync:u});function f(e){if(!s.isObject(e)||s.isObject(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}const l=Array.isArray;function d(e,r,n){const o=t.unref(e),a=t.isRef(e);l(o)&&function(e){const t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}(r)?(o.length=Math.max(o.length,r),a?e.value.splice(r,1,n):e.splice(r,1,n)):s.isValidKey(r)&&s.isObject(o)?a?e.value[r]=n:e[r]=n:a?e.value=n:e=n}function h(e,r){if(s.isObject(e)||Array.isArray(e))return s.isValidKey(r)?t.isRef(e)?r in e.value?e.value[r]:void 0:e[r]:t.isRef(e)?e.value:e}function y(e,t){return!(!s.isObject(e)&&!Array.isArray(e))&&(!!s.isValidKey(t)&&(!!(f(e)&&e.value&&t in e.value)||(!(!e||!(t in e))||void 0)))}function m(e,s){const r=t.unref(e),n=t.isRef(e);if(console.log({target:e,value:s}),Array.isArray(r))return n?(e.value.push(s),e.value.slice(-1)[0]):(e.push(s),e.slice(-1)[0])}function g(e,s){const r=t.unref(e),n=t.isRef(e);if(Array.isArray(r))return n?(e.value.unshift(s),e.value[0]):(e.unshift(s),e[0])}function v(e=[]){return"_state"!==e[0]?["_state",...e]:e}const S=s.makeSet({setProp:d,getProp:h,hasProp:y,afterGetSteps:v}),P=s.makeHas({getProp:h,hasProp:y,afterGetSteps:v}),k=s.makeGet({getProp:h,hasProp:y,afterGetSteps:v}),j=s.makeRemove({getProp:h,hasProp:y,removeProp:function(e,r){const n=t.unref(e),o=t.isRef(e);return Array.isArray(n)?(o?e.value.splice(+r,1):e.splice(+r,1),!0):!!s.isObject(n)&&(o?e.value=function(e,t=[]){return Object.keys(e).reduce((s,r)=>(t.includes(r)||(s[r]=e[r]),s),{})}(e.value,[r]):delete e[r],!0)},afterGetSteps:v}),b=s.makePush({getProp:h,hasProp:y,pushProp:m,afterGetSteps:v}),O=s.makeUnshift({getProp:h,hasProp:y,unshiftProp:g,afterGetSteps:v}),A=s.makeSet({setProp:d,getProp:h,hasProp:y}),w=s.makeHas({getProp:h,hasProp:y}),T=s.makeGet({getProp:h,hasProp:y}),_=s.makeRemove({getProp:h,hasProp:y}),G=s.makePush({getProp:h,hasProp:y,pushProp:m}),R=s.makeUnshift({getProp:h,hasProp:y,unshiftProp:g});var x=Object.freeze({__proto__:null,teddySet:S,teddyHas:P,teddyGet:k,teddyRemove:j,teddyPush:b,teddyUnshift:O,set:A,has:w,get:T,remove:_,push:G,unshift:R});r.use(o);const $=Symbol(),V=Symbol(),W={__options:{devtools:!0},spaces:{}},F="$",M="@",z=e=>{let t,r;if(s.isObject(e))t="space"in e?e.space:F,r="name"in e?e.name:M;else if("string"==typeof e)if(e.includes(".")){let[s,n]=e.split(".");t=s,r=n}else if(e.includes("/")){let[s,n]=e.split("/");t=s,r=n}else t=F,r=e;return"string"==typeof t&&(t=t.trim(),0===t.length&&(t=void 0)),"string"==typeof r&&(r=r.trim(),0===r.length&&(r=void 0)),{space:t,name:r}},H=(e,t)=>{const s=z(e);t=t||{};const r=pe(s);return N(s,t.state),C(s,t.getters),I(s,t.actions),B(s,t.watchers),r},J=(e,s)=>t.isRef(s)?s:t.ref(s),K=(e,t,s={})=>(s._state=J(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),N=(e,t)=>{const s=pe(e);K(0,t,s)},U=(e,t)=>{const s=pe(e);return t=t||{},Object.keys(t).reduce((e,r)=>(f(t[r])?e[r]=t[r]:"function"==typeof t[r]&&(e[r]=ye(()=>t[r](s))),e),{})},C=(e,t)=>{const s=pe(e);return s.getters={...s.getters||{},...U(e,t)},s},D=(e,t)=>{const s=pe(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},I=(e,t)=>{const s=pe(e);return s.actions={...s.actions||{},...D(e,t)},s},q=(e,s)=>{const{name:r}=z(e),o=pe(e),a=[];return Array.isArray(s)?a.push(...s):s&&a.push(s),0===a.length?[]:a.reduce((e,s)=>{const a=(e,t=null)=>{const s=function(t,s){e.call(this,t,s,n(t,s))};return"number"==typeof t?function(e,t=100){let s;return function(...r){clearTimeout(s),s=setTimeout(()=>{e.apply(this,r)},t)}}(s,t):s},c=(e="",t)=>`${e}||${t.toString()}`,i=(s,r,n,o={})=>{e.push({path:s,signature:c(s,n),options:o,start(){return this.unwatch=t.watch(r,a(n,o.debounce),{deep:!0,...o}),this}})};if("function"==typeof s)i("state",()=>o.state,s,{deep:!0});else if(s&&"object"==typeof s&&"handler"in s){const{handler:e,path:t,paths:n=[],...a}=s;"string"==typeof t?i(t,()=>k(o,t),e,{deep:!0,...a}):n.length>0?i(n.map(e=>[r,e].filter(Boolean).filter(e=>e.length>0).join(".")),n.map(e=>()=>k(o,e)),e,{deep:!0,...a}):i("state",()=>o.state,e,{deep:!0,...a})}return e},[])},B=(e,t)=>{const s=pe(e);for(const r of q(e,t)){const e=s.watchers.find(e=>{const t=e.path===r.path,s=e.signature===r.signature;return t&&s});e&&e.unwatch(),s.watchers.push(r.start())}return s},E=e=>{const{space:t,name:s}=z(e);return void 0!==s?t in W.spaces&&"stores"in W.spaces[t]&&s in W.spaces[t].stores:t in W.spaces},L=e=>{},Q=(e,t,...s)=>{const{store:r}=fe(e);if(t in r.actions)try{return r.actions[t](...s)}catch(e){console.error(`Something went wrong with the action '${t}'`),console.error(e)}else console.warn(`Couldn't find the action '${t}' to run.`)},X=(e,t,s)=>{r.config.devtools&&console.log("remove()",{definition:e,path:t,context:s});const{space:n,name:o}=z(e),a=pe({space:n,name:o});return j(a,t,s)},Y=(e,t,s)=>{const r=pe(e);return P(r,t,s)},Z=(e,t,s,r)=>{const{space:n,name:o}=z(e),a=pe({space:n,name:o});return k(a,t,s)||r},ee=(e,t,s,r)=>function(){return Z(e,t,s||this,r)},te=(e,t,s,n)=>{r.config.devtools&&console.log("set()",{definition:e,path:t,value:s,context:n});const o=pe(e);S(o,t,s,n)},se=(e,t,s)=>function(r){te(e,t,r,s||this)},re=(e,t,s,n)=>{r.config.devtools&&console.log("push()",{definition:e,path:t,value:s,context:n});const o=pe(e);b(o,t,s,n)},ne=(e,t,s,n)=>{r.config.devtools&&console.log("unshift()",{definition:e,path:t,value:s,context:n});const o=pe(e);O(o,t,s,n)},oe=(e,t,r)=>{const n=(t,s)=>({get:ee(e,t,s),set:se(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=n(t,r),e),{}):s.isObject(t)?Object.keys(t).reduce((e,s)=>(e[s]=n(t[s],r),e),{}):n(t,r)},ae=(e={})=>{"function"==typeof e.teddy&&e.teddy(W);for(const t of Object.keys(W.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(W.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},ce=(e=(e=>e))=>({setStore:e(H),makeState:e(J),setState:e(N),applyState:e(K),makeGetters:e(U),setGetters:e(C),makeActions:e(D),setActions:e(I),makeWatchers:e(q),setWatchers:e(B),exists:e(E),reset:e(L),run:e(Q),remove:e(X),has:e(Y),get:e(Z),getter:e(ee),set:e(te),setter:e(se),sync:e(oe),push:e(re),unshift:e(ne)}),ie=(e=F)=>(e in W.spaces||(W.spaces[e]={}),W.spaces[e]),ue=(e=F)=>({store:ie(e),...ce(t=>(...s)=>t({space:e,name:M},...s))}),pe=e=>{const{space:t=F,name:s=M}=z(e);return ie(t),"stores"in W.spaces[t]||(W.spaces[t].stores={}),s in W.spaces[t].stores||(W.spaces[t].stores[s]={getters:{},actions:{},watchers:[],options:{},features:{}},K(0,{},W.spaces[t].stores[s])),W.spaces[t].stores[s]},fe=e=>({store:pe(e),...ce(t=>(...s)=>t(e,...s))}),le=e=>{t.provide(V,fe(e))},de=()=>{t.inject($)},he=()=>{t.inject(V)},ye=e=>{if(s.isObject(e)){const s="get"in e&&"function"==typeof e.get,r="set"in e&&"function"==typeof e.set;return s||r?t.computed(e):Object.keys(e).reduce((s,r)=>(s[r]=t.computed(e[r]),s),{})}return t.computed(e)};var me=Object.freeze({__proto__:null,accessors:x,features:p,Teddy:$,TeddyStore:V,Teddies:W,setStore:H,makeState:J,applyState:K,setState:N,makeGetters:U,setGetters:C,makeActions:D,setActions:I,makeWatchers:q,setWatchers:B,exists:E,reset:L,run:Q,remove:X,has:Y,get:Z,getter:ee,set:te,setter:se,push:re,unshift:ne,sync:oe,setFeature:ae,mapMethods:ce,getTeddy:ie,useTeddy:ue,getStore:pe,useStore:fe,provideTeddyStore:le,injectTeddy:de,injectTeddyStore:he,computed:ye});return e.Teddies=W,e.Teddy=$,e.TeddyStore=V,e.accessors=x,e.applyState=K,e.computed=ye,e.exists=E,e.features=p,e.get=Z,e.getStore=pe,e.getTeddy=ie,e.getter=ee,e.has=Y,e.injectTeddy=de,e.injectTeddyStore=he,e.install=e=>{e.prototype.$teddy=me},e.makeActions=D,e.makeGetters=U,e.makeState=J,e.makeWatchers=q,e.mapMethods=ce,e.provideTeddyStore=le,e.push=re,e.remove=X,e.reset=L,e.run=Q,e.set=te,e.setActions=I,e.setFeature=ae,e.setGetters=C,e.setState=N,e.setStore=H,e.setWatchers=B,e.setter=se,e.sync=oe,e.unshift=ne,e.useStore=fe,e.useTeddy=ue,e}({},vueCompositionApi,objectStringPath,Vue,equal);
