/*!
  * vue-teddy-store v0.1.36
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.1.36
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
var VueTeddyStore=function(e,t,s,r,a){"use strict";var o="default"in s?s.default:s;a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;const n=(e,t)=>`teddy:${e}:${t}`;var c={store(e,s){const r=t.getTeddyStore(e,s);if(r.features.cache)return;const a=window.localStorage||global.localStorage||{};if(a){const o=a.getItem(n(e,s));o&&(r.state={...r.state,...JSON.parse(o)}),t.setWatchers({space:e,name:s},{handler(t,r){t!==r&&a.setItem(n(e,s),JSON.stringify(t))},immediate:!0,deep:!0}),r.features.cache=!0}}},i={store(e,r){const a=t.getTeddyStore(e,r);a.features.history||(a.features.history={},a.features.history.stack=s.reactive([]),t.setWatchers({space:e,name:r},{handler(e){a.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),a.features.history.installed=!0)}},u={store(e,s){const r=t.getTeddyStore(e,s);r.features.sync||(r.features.sync={},window&&window.addEventListener("storage",e=>{e.key===n(s)&&(r.state={...r.state,...JSON.parse(e.newValue)})}),r.features.sync.installed=!0)}},d=Object.freeze({__proto__:null,cache:c,history:i,sync:u});function p(e){if(!r.isObject(e)||r.isObject(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}function l(e,t,s){return r.isValidKey(t)&&(r.isObject(e)||Array.isArray(e))?p(e)&&"value"in e&&t in e.value?(e.value[t]=s,e.value[t]):(e[t]=s,e[t]):e&&null==t?(p(e)&&"value"in e?e.value=s:r.isObject(s)?Object.assign(e,s):e=s,e):void console.log("Couldn't not set "+t)}function y(e,t){return r.isValidKey(t)?p(e)?t in e.value?e.value[t]:e.value:r.isObject(e)||Array.isArray(e)?e[t]:void 0:e&&void 0===t?p(e)?e.value:e:void 0}function f(e,t){return!(!r.isObject(e)&&!Array.isArray(e))&&(!!r.isValidKey(t)&&(!!(p(e)&&e.value&&t in e.value)||(!(!e||!(t in e))||void 0)))}function m(e=[]){return["_state",...e]}const v=r.makeSet({setProp:l,getProp:y,hasProp:f,afterGetSteps:m}),h=r.makeHas({getProp:y,hasProp:f,afterGetSteps:m}),g=r.makeGet({getProp:y,hasProp:f,afterGetSteps:m}),S=r.makeSet({setProp:l,getProp:y,hasProp:f}),j=r.makeHas({getProp:y,hasProp:f}),b=r.makeGet({getProp:y,hasProp:f});var O=Object.freeze({__proto__:null,teddySet:v,teddyHas:h,teddyGet:g,set:S,has:j,get:b});a.use(o);const k=Symbol(),T=Symbol(),P=s.ref({__options:{devtools:!0},spaces:{}}),_=(e="$",t="@")=>{let s=e,a=t;if("string"==typeof e&&e.includes(".")){const t=e.split(".");s=t[0]||s,a=t[1]||a}else e&&r.isObject(e)?(s=e.space||s,a=e.name||a):t&&r.isObject(t)&&(s=t.space||s,a=t.name||a);return"string"==typeof s&&(s=s.trim()),"string"==typeof a&&(a=a.trim()),{space:s,name:a}},A=(e,t)=>{const s=_(r.isObject(e)?e:{name:e});t=t||{};const a=Y(s);return $(s,t.state),V(s,t.getters),D(s,t.actions),H(s,t.watchers),a},w=(e,t)=>s.isRef(t)?t:s.ref(t),G=(e,t,s={})=>(s._state=w(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),$=(e,t)=>{const s=Y(e);G(0,t,s)},W=(e,t)=>{const s=Y(e);return t=t||{},Object.keys(t).reduce((e,r)=>(p(t[r])?e[r]=t[r]:"function"==typeof t[r]&&(e[r]=ae(()=>t[r](s))),e),{})},V=(e,t)=>{const s=Y(e);return s.getters={...s.getters||{},...W(e,t)},s},x=(e,t)=>{const s=Y(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},D=(e,t)=>{const s=Y(e);return s.actions={...s.actions||{},...x(e,t)},s},z=(e,t)=>{const{name:r}=_(e),a=Y(e),o=[];return Array.isArray(t)?o.push(...t):t&&o.push(t),0===o.length?[]:o.reduce((e,t)=>{const o=(t,r,a,o)=>{const n=s.watch(r,a,{deep:!0,...o});e.push({path:t,handler:a,options:o,unwatch:n})};if("function"==typeof t)o("state",()=>a.state,t,{deep:!0});else if(t&&"object"==typeof t&&"handler"in t){const{handler:e,path:s,paths:n=[],...c}=t;"string"==typeof s?o(s,()=>g(a,s),e,{deep:!0,...c}):n.length>0?o(n.map(e=>[r,e].filter(Boolean).filter(e=>e.length>0).join(".")),n.map(e=>()=>g(a,e)),e,{deep:!0,...c}):o("state",()=>a.state,e,{deep:!0,...c})}return e},[])},H=(e,t)=>{const s=Y(e);return s.watchers=[...s.watchers||[],...z(e,t)],s},J=e=>{const{space:t,name:s}=_(e);return void 0!==s?t in P.value.spaces&&"stores"in P.value.spaces[t]&&s in P.value.spaces[t].stores:t in P.value.spaces},K=e=>{const{space:t,name:s}=_(e),r=q(t);s in r.stores&&delete r.stores[s]},N=e=>{},C=(e,t,s)=>{const r=Y(e);return h(r,t,s)},F=(e,t,s)=>{const r=Y(e);return g(r,t,s)},I=(e,t,s)=>function(){return F(e,t,s||this)},M=(e,t,s,r)=>{const a=Y(e);v(a,t,s,r)},B=(e,t,s)=>function(r){M(e,t,r,s||this)},E=(e,t,s)=>{const a=(t,s)=>({get:I(e,t,s),set:B(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=a(t,s),e),{}):r.isObject(t)?Object.keys(t).reduce((e,r)=>(e[r]=a(t[r],s),e),{}):a(t,s)},L=(e={})=>{"function"==typeof e.teddy&&e.teddy(P.value);for(const t of Object.keys(P.value.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(P.value.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},R=(e=(e=>e))=>({setStore:e(A),makeState:e(w),setState:e($),applyState:e(G),makeGetters:e(W),setGetters:e(V),makeActions:e(x),setActions:e(D),makeWatchers:e(z),setWatchers:e(H),exists:e(J),remove:e(K),reset:e(N),has:e(C),get:e(F),getter:e(I),set:e(M),setter:e(B),sync:e(E)}),q=(e="$")=>(e in P.value.spaces||(P.value.spaces[e]={}),P.value.spaces[e]),Q=(e="$")=>({store:q(e),...R(t=>(...s)=>t({space:e,name:"@"},...s))}),U=(e="@")=>Y("$",e),X=(e="@")=>({store:U(e),...R(t=>(...s)=>t({name:e,space:"$"},...s))}),Y=(e,t)=>{const{space:s,name:r}=_(e,t);return q(s),"stores"in P.value.spaces[s]||(P.value.spaces[s].stores={}),r in P.value.spaces[s].stores||(P.value.spaces[s].stores[r]={getters:{},actions:{},watchers:[],options:{},features:{}},G(0,{},P.value.spaces[s].stores[r])),P.value.spaces[s].stores[r]},Z=(e="$",t="@")=>({store:Y(e,t),...R(s=>(...r)=>s({space:e,name:t},...r))}),ee=(e="$")=>{s.provide(k,Q(e))},te=(...e)=>{s.provide(T,Z(...e))},se=()=>{s.inject(k)},re=()=>{s.inject(T)},ae=e=>{if(r.isObject(e)){const t="get"in e&&"function"==typeof e.get,r="set"in e&&"function"==typeof e.set;return t||r?s.computed(e):Object.keys(e).reduce((t,r)=>(t[r]=s.computed(e[r]),t),{})}return s.computed(e)};var oe=Object.freeze({__proto__:null,accessors:O,features:d,Teddy:k,TeddyStore:T,Teddies:P,parseDefinition:_,setStore:A,makeState:w,applyState:G,setState:$,makeGetters:W,setGetters:V,makeActions:x,setActions:D,makeWatchers:z,setWatchers:H,exists:J,remove:K,reset:N,has:C,get:F,getter:I,set:M,setter:B,sync:E,setFeature:L,mapMethods:R,getTeddy:q,useTeddy:Q,getStore:U,useStore:X,getTeddyStore:Y,useTeddyStore:Z,provideTeddy:ee,provideTeddyStore:te,injectTeddy:se,injectTeddyStore:re,computed:ae});return e.Teddies=P,e.Teddy=k,e.TeddyStore=T,e.accessors=O,e.applyState=G,e.computed=ae,e.exists=J,e.features=d,e.get=F,e.getStore=U,e.getTeddy=q,e.getTeddyStore=Y,e.getter=I,e.has=C,e.injectTeddy=se,e.injectTeddyStore=re,e.install=e=>{e.prototype.$teddy=oe},e.makeActions=x,e.makeGetters=W,e.makeState=w,e.makeWatchers=z,e.mapMethods=R,e.parseDefinition=_,e.provideTeddy=ee,e.provideTeddyStore=te,e.remove=K,e.reset=N,e.set=M,e.setActions=D,e.setFeature=L,e.setGetters=V,e.setState=$,e.setStore=A,e.setWatchers=H,e.setter=B,e.sync=E,e.useStore=X,e.useTeddy=Q,e.useTeddyStore=Z,e}({},index$1,vueCompositionApi,objectStringPath,Vue);
