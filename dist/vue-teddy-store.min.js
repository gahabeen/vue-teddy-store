/*!
  * vue-teddy-store v0.3.0
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.3.0
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
var VueTeddyStore=function(e,t,s,r,n,o,a){"use strict";var c="default"in t?t.default:t;r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;const i=(e,t)=>`teddy:${e}:${t}`;var u={store(e,t){const s=ge({space:e,name:t});if(s.features.cache)return;const r=window.localStorage||global.localStorage||{};if(r){const n=r.getItem(i(e,t));n&&(s.state=JSON.parse(n)),Y({space:e,name:t},{handler(s){r.setItem(i(e,t),JSON.stringify(s))},immediate:!0,deep:!0}),s.features.cache=!0}}},p={store(e,s){const r=ge({space:e,name:s});r.features.history||(r.features.history={},r.features.history.stack=t.reactive([]),Y({space:e,name:s},{handler(e){r.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),r.features.history.installed=!0)}},f={store(e,t){const s=ge({space:e,name:t});s.features.sync||(s.features.sync={},window&&window.addEventListener("storage",r=>{r.key===i(e,t)&&(s.state={...s.state,...JSON.parse(r.newValue)})}),s.features.sync.installed=!0)}},d=Object.freeze({__proto__:null,cache:u,history:p,sync:f});function l(e){if(!s.isObject(e)||s.isObject(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}const h=(e={})=>{const t=e.__ob__;return()=>{t&&t.dep.notify()}};function y(e,r,n){const o=t.isRef(e);(function(e){const t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)})(r)||s.isValidKey(r)?o?t.set(e.value,r,n):t.set(e,r,n):o?e.value=n:e=n}function m(e,r){if(s.isObject(e)||Array.isArray(e))return s.isValidKey(r)?t.isRef(e)?e.value[r]:e[r]:t.isRef(e)?e.value:e}function g(e,t){return!(!s.isObject(e)&&!Array.isArray(e))&&(!!s.isValidKey(t)&&(!!(l(e)&&e.value&&t in e.value)||(!(!e||!(t in e))||void 0)))}function v(e,s){const r=t.unref(e),n=t.isRef(e),o=h(e);if(Array.isArray(r))return n?(e.value.push(s),o(),e.value.slice(-1)[0]):(e.push(s),o(),e.slice(-1)[0])}function P(e,s){const r=t.unref(e),n=t.isRef(e);if(Array.isArray(r))return n?(e.value.unshift(s),e.value):(e.unshift(s),e)}function S(e,s,r){const n=t.unref(e),o=t.isRef(e),a=h(e);if(Array.isArray(n))return o?(e.value.splice(s,0,r),a(),e.value):(e.splice(s,0,r),a(),e)}function k(e=[]){return"_state"!==e[0]?["_state",...e]:e}const b=s.makeSet({setProp:y,getProp:m,hasProp:g,afterGetSteps:k}),j=s.makeHas({getProp:m,hasProp:g,afterGetSteps:k}),O=s.makeGet({getProp:m,hasProp:g,afterGetSteps:k}),w=s.makeRemove({getProp:m,hasProp:g,removeProp:function(e,r){const n=t.unref(e),o=t.isRef(e),a=h(e);return Array.isArray(n)?(o?e.value.splice(+r,1):e.splice(+r,1),a(),!0):!!s.isObject(n)&&(o?e.value=function(e,t=[]){return Object.keys(e).reduce((s,r)=>(t.includes(r)||(s[r]=e[r]),s),{})}(e.value,[r]):delete e[r],a(),!0)},afterGetSteps:k}),A=s.makePush({getProp:m,hasProp:g,pushProp:v,afterGetSteps:k}),_=s.makeUnshift({getProp:m,hasProp:g,unshiftProp:P,afterGetSteps:k}),T=s.makeInsert({getProp:m,hasProp:g,insertProp:S,afterGetSteps:k}),G=s.makeSet({setProp:y,getProp:m,hasProp:g}),R=s.makeHas({getProp:m,hasProp:g}),$=s.makeGet({getProp:m,hasProp:g}),V=s.makeRemove({getProp:m,hasProp:g}),W=s.makePush({getProp:m,hasProp:g,pushProp:v}),I=s.makeUnshift({getProp:m,hasProp:g,unshiftProp:P}),F=s.makeInsert({getProp:m,hasProp:g,insertProp:S});var x=Object.freeze({__proto__:null,teddySet:b,teddyHas:j,teddyGet:O,teddyRemove:w,teddyPush:A,teddyUnshift:_,teddyInsert:T,set:G,has:R,get:$,remove:V,push:W,unshift:I,insert:F});r.use(c);const z=Symbol(),C=Symbol(),H={__options:{devtools:!0},spaces:{}},J="$",K="@",M=e=>{let t,r;if(s.isObject(e))t="space"in e?e.space:J,r="name"in e?e.name:K;else if("string"==typeof e)if(e.includes(".")){let[s,n]=e.split(".");t=s,r=n}else if(e.includes("/")){let[s,n]=e.split("/");t=s,r=n}else t=J,r=e;return"string"==typeof t&&(t=t.trim(),0===t.length&&(t=void 0)),"string"==typeof r&&(r=r.trim(),0===r.length&&(r=void 0)),{space:t,name:r}},N=(e,t)=>{const s=M(e);t=t||{};const r=ge(s);return q(s,t.state),E(s,t.getters),Q(s,t.actions),Y(s,t.watchers),r},U=(e,s)=>t.isRef(s)?s:t.ref(s),D=(e,t,s={})=>(s._state=U(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),q=(e,t)=>{const s=ge(e);D(0,t,s)},B=(e,t)=>{const s=ge(e);return t=t||{},Object.keys(t).reduce((e,r)=>(l(t[r])?e[r]=t[r]:"function"==typeof t[r]&&(a(t[r]).length>1?e[r]=(...e)=>be(()=>t[r](s,...e)):e[r]=be(()=>t[r](s))),e),{})},E=(e,t)=>{const s=ge(e);return s.getters={...s.getters||{},...B(e,t)},s},L=(e,t)=>{const s=ge(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},Q=(e,t)=>{const s=ge(e);return s.actions={...s.actions||{},...L(e,t)},s},X=(e,s)=>{const{name:r}=M(e),a=ge(e),c=[];return Array.isArray(s)?c.push(...s):s&&c.push(s),0===c.length?[]:c.reduce((e,s)=>{const c=(e,t=null)=>{const s=function(t,s){e.call(this,t,s,o(t,s))};return"number"==typeof t?n(s,t,!0):s},i=(e="",t)=>`${e}||${t.toString()}`,u=(s,r,n,o={})=>{e.push({path:s,signature:i(s,n),options:o,start(){return this.unwatch=t.watch(r,c(n,o.debounce),{deep:!0,...o}),this}})};if("function"==typeof s)u("state",()=>a.state,s,{deep:!0});else if(s&&"object"==typeof s&&"handler"in s){const{handler:e,path:t,paths:n=[],...o}=s;"string"==typeof t?u(t,()=>O(a,t),e,{deep:!0,...o}):n.length>0?u(n.map(e=>[r,e].filter(Boolean).filter(e=>e.length>0).join(".")),n.map(e=>()=>O(a,e)),e,{deep:!0,...o}):u("state",()=>a.state,e,{deep:!0,...o})}return e},[])},Y=(e,t)=>{const s=ge(e);for(const r of X(e,t)){const e=s.watchers.find(e=>{const t=e.path===r.path,s=e.signature===r.signature;return t&&s});e&&e.unwatch(),s.watchers.push(r.start())}return s},Z=e=>{const{space:t,name:s}=M(e);return void 0!==s?t in H.spaces&&"stores"in H.spaces[t]&&s in H.spaces[t].stores:t in H.spaces},ee=e=>{},te=(e,t,...s)=>{const{store:r}=ve(e);if(t in r.actions)try{return r.actions[t](...s)}catch(e){console.error(`Something went wrong with the action '${t}'`),console.error(e)}else console.warn(`Couldn't find the action '${t}' to run.`)},se=(e,t,...s)=>{const{store:r}=ve(e);if(t in r.getters)try{return"function"==typeof r.getters[t]?r.getters[t](...s):r.getters[t]}catch(e){console.error(`Something went wrong with the getter '${t}'`),console.error(e)}else console.warn(`Couldn't find the getter '${t}' to resolve.`)},re=(e,t,s)=>{const{space:r,name:n}=M(e),o=ge({space:r,name:n});return w(o,t,s)},ne=(e,t,s)=>{const r=ge(e);return j(r,t,s)},oe=(e,t,s,r)=>{const{space:n,name:o}=M(e),a=ge({space:n,name:o});return O(a,t,s)||r},ae=(e,t,s,r)=>function(){return oe(e,t,s||this,r)},ce=(e,t,s,r)=>{const n=ge(e);b(n,t,s,r)},ie=(e,t,s)=>function(r){ce(e,t,r,s||this)},ue=(e,t,s,r)=>{const n=ge(e);A(n,t,s,r)},pe=(e,t,s,r)=>{const n=ge(e);T(n,t,s,r)},fe=(e,t,s,r)=>{const n=ge(e);_(n,t,s,r)},de=(e,t,r)=>{const n=(t,s)=>({get:ae(e,t,s),set:ie(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=n(t,r),e),{}):s.isObject(t)?Object.keys(t).reduce((e,s)=>(e[s]=n(t[s],r),e),{}):n(t,r)},le=(e={})=>{"function"==typeof e.teddy&&e.teddy(H);for(const t of Object.keys(H.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(H.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},he=(e=(e=>e))=>({setStore:e(N),makeState:e(U),setState:e(q),applyState:e(D),makeGetters:e(B),setGetters:e(E),makeActions:e(L),setActions:e(Q),makeWatchers:e(X),setWatchers:e(Y),exists:e(Z),reset:e(ee),run:e(te),resolve:e(se),remove:e(re),has:e(ne),get:e(oe),getter:e(ae),set:e(ce),setter:e(ie),sync:e(de),push:e(ue),unshift:e(fe),insert:e(pe)}),ye=(e=J)=>(e in H.spaces||(H.spaces[e]={}),H.spaces[e]),me=(e=J)=>({store:ye(e),...he(t=>(...s)=>t({space:e,name:K},...s))}),ge=e=>{const{space:t=J,name:s=K}=M(e);return ye(t),"stores"in H.spaces[t]||(H.spaces[t].stores={}),s in H.spaces[t].stores||(H.spaces[t].stores[s]={getters:{},actions:{},watchers:[],options:{},features:{}},D(0,{},H.spaces[t].stores[s])),H.spaces[t].stores[s]},ve=e=>({store:ge(e),...he(t=>(...s)=>t(e,...s))}),Pe=e=>{t.provide(C,ve(e))},Se=()=>{t.inject(z)},ke=()=>{t.inject(C)},be=e=>{if(s.isObject(e)){const s="get"in e&&"function"==typeof e.get,r="set"in e&&"function"==typeof e.set;return s||r?t.computed(e):Object.keys(e).reduce((s,r)=>(s[r]=t.computed(e[r]),s),{})}return t.computed(e)};var je=Object.freeze({__proto__:null,accessors:x,features:d,Teddy:z,TeddyStore:C,Teddies:H,setStore:N,makeState:U,applyState:D,setState:q,makeGetters:B,setGetters:E,makeActions:L,setActions:Q,makeWatchers:X,setWatchers:Y,exists:Z,reset:ee,run:te,resolve:se,remove:re,has:ne,get:oe,getter:ae,set:ce,setter:ie,push:ue,insert:pe,unshift:fe,sync:de,setFeature:le,mapMethods:he,getTeddy:ye,useTeddy:me,getStore:ge,useStore:ve,provideTeddyStore:Pe,injectTeddy:Se,injectTeddyStore:ke,computed:be});return e.Teddies=H,e.Teddy=z,e.TeddyStore=C,e.accessors=x,e.applyState=D,e.computed=be,e.exists=Z,e.features=d,e.get=oe,e.getStore=ge,e.getTeddy=ye,e.getter=ae,e.has=ne,e.injectTeddy=Se,e.injectTeddyStore=ke,e.insert=pe,e.install=e=>{e.prototype.$teddy=je},e.makeActions=L,e.makeGetters=B,e.makeState=U,e.makeWatchers=X,e.mapMethods=he,e.provideTeddyStore=Pe,e.push=ue,e.remove=re,e.reset=ee,e.resolve=se,e.run=te,e.set=ce,e.setActions=Q,e.setFeature=le,e.setGetters=E,e.setState=q,e.setStore=N,e.setWatchers=Y,e.setter=ie,e.sync=de,e.unshift=fe,e.useStore=ve,e.useTeddy=me,e}({},vueCompositionApi,objectStringPath,Vue,debounce,equal,fnAnnotate);
