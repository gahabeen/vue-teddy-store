/*!
  * vue-teddy-store v0.4.1
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.4.1
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
var VueTeddyStore=function(e,t,s,r,n,o){"use strict";r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o;const a=(e,t)=>`teddy:${e}:${t}`;var c={store(e,t){const s=he({space:e,name:t});if(s.features.cache)return;const r=window.localStorage||global.localStorage||{};if(r){const n=r.getItem(a(e,t));n&&(s.state=JSON.parse(n)),L({space:e,name:t},{handler(s){r.setItem(a(e,t),JSON.stringify(s))},immediate:!0,deep:!0}),s.features.cache=!0}}},i={store(e,s){const r=he({space:e,name:s});r.features.history||(r.features.history={},r.features.history.stack=t.reactive([]),L({space:e,name:s},{handler(e){r.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),r.features.history.installed=!0)}},u={store(e,t){const s=he({space:e,name:t});s.features.sync||(s.features.sync={},window&&window.addEventListener("storage",r=>{r.key===a(e,t)&&(s.state={...s.state,...JSON.parse(r.newValue)})}),s.features.sync.installed=!0)}},p=Object.freeze({__proto__:null,cache:c,history:i,sync:u});const f=(e={})=>{const t=e.__ob__;return()=>{t&&t.dep.notify()}};function d(e,r,n){const o=t.isRef(e);return function(e){const t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}(r)||s.isValidKey(r)?o?(e.value[r]=n,e.value[r]):(e[r]=n,e[r]):o?(e.value=n,e.value):e=n}function l(e,r){if(s.isObject(e)||Array.isArray(e))return s.isValidKey(r)?t.isRef(e)?e.value[r]:e[r]:t.isRef(e)?e.value:e}function h(e,r){return!(!s.isObject(e)&&!Array.isArray(e))&&(!!s.isValidKey(r)&&(!(!t.isRef(e)||!(r in e.value))||(!(!e||!(r in e))||void 0)))}function y(e,s){const r=t.unref(e),n=t.isRef(e),o=f(e);if(Array.isArray(r))return n?(e.value.push(s),o(),e.value.slice(-1)[0]):(e.push(s),o(),e.slice(-1)[0])}function m(e,s){const r=t.unref(e),n=t.isRef(e);if(Array.isArray(r))return n?(e.value.unshift(s),e.value):(e.unshift(s),e)}function g(e,s,r){const n=t.unref(e),o=t.isRef(e),a=f(e);if(Array.isArray(n))return o?(e.value.splice(s,0,r),a(),e.value):(e.splice(s,0,r),a(),e)}function P(e=[]){return"_state"!==e[0]?["_state",...e]:e}const S=s.makeSet({setProp:d,getProp:l,hasProp:h,afterGetSteps:P}),v=s.makeHas({getProp:l,hasProp:h,afterGetSteps:P}),k=s.makeGet({getProp:l,hasProp:h,afterGetSteps:P}),b=s.makeRemove({getProp:l,hasProp:h,removeProp:function(e,r){const n=t.unref(e),o=t.isRef(e),a=f(e);return Array.isArray(n)?(o?e.value.splice(+r,1):e.splice(+r,1),a(),!0):!!s.isObject(n)&&(o?delete e.value[r]:delete e[r],a(),!0)},afterGetSteps:P}),j=s.makePush({getProp:l,hasProp:h,pushProp:y,afterGetSteps:P}),w=s.makeUnshift({getProp:l,hasProp:h,unshiftProp:m,afterGetSteps:P}),O=s.makeInsert({getProp:l,hasProp:h,insertProp:g,afterGetSteps:P}),A=s.makeSet({setProp:d,getProp:l,hasProp:h}),_=s.makeHas({getProp:l,hasProp:h}),T=s.makeGet({getProp:l,hasProp:h}),G=s.makeRemove({getProp:l,hasProp:h}),R=s.makePush({getProp:l,hasProp:h,pushProp:y}),$=s.makeUnshift({getProp:l,hasProp:h,unshiftProp:m}),V=s.makeInsert({getProp:l,hasProp:h,insertProp:g});var W=Object.freeze({__proto__:null,teddySet:S,teddyHas:v,teddyGet:k,teddyRemove:b,teddyPush:j,teddyUnshift:w,teddyInsert:O,set:A,has:_,get:T,remove:G,push:R,unshift:$,insert:V});const I=Symbol(),F=Symbol(),x={__options:{devtools:!0},spaces:{}},z="$",H="@",J=e=>{let t,r;if(s.isObject(e))t="space"in e?e.space:z,r="name"in e?e.name:H;else if("string"==typeof e)if(e.includes(".")){let[s,n]=e.split(".");t=s,r=n}else if(e.includes("/")){let[s,n]=e.split("/");t=s,r=n}else t=z,r=e;return"string"==typeof t&&(t=t.trim(),0===t.length&&(t=void 0)),"string"==typeof r&&(r=r.trim(),0===r.length&&(r=void 0)),{space:t,name:r}},K=(e,t)=>{const s=J(e);t=t||{};const r=he(s);return U(s,t.state),q(s,t.getters),D(s,t.actions),L(s,t.watchers),r},M=(e,s)=>t.isRef(s)?s:t.ref(s),N=(e,t,s={})=>(s._state=M(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),U=(e,t)=>{const s=he(e);N(0,t,s)},C=(e,s)=>{const r=he(e);return s=s||{},Object.keys(s).reduce((e,n)=>(t.isRef(s[n])?e[n]=s[n]:"function"==typeof s[n]&&(o(s[n]).length>1?e[n]=(...e)=>Se(()=>s[n](r,...e)):e[n]=Se(()=>s[n](r))),e),{})},q=(e,t)=>{const s=he(e);return s.getters={...s.getters||{},...C(e,t)},s},B=(e,t)=>{const s=he(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},D=(e,t)=>{const s=he(e);return s.actions={...s.actions||{},...B(e,t)},s},E=(e,s)=>{const{name:o}=J(e),a=he(e),c=[];return Array.isArray(s)?c.push(...s):s&&c.push(s),0===c.length?[]:c.reduce((e,s)=>{const c=(e,t=null)=>{const s=function(t,s){e.call(this,t,s,n(t,s))};return"number"==typeof t?r(s,t,!0):s},i=(e="",t)=>`${e}||${t.toString()}`,u=(s,r,n,o={})=>{e.push({path:s,signature:i(s,n),options:o,start(){return this.unwatch=t.watch(r,c(n,o.debounce),{deep:!0,...o}),this}})};if("function"==typeof s)u("state",()=>a.state,s,{deep:!0});else if(s&&"object"==typeof s&&"handler"in s){const{handler:e,path:t,paths:r=[],...n}=s;"string"==typeof t?u(t,()=>k(a,t),e,{deep:!0,...n}):r.length>0?u(r.map(e=>[o,e].filter(Boolean).filter(e=>e.length>0).join(".")),r.map(e=>()=>k(a,e)),e,{deep:!0,...n}):u("state",()=>a.state,e,{deep:!0,...n})}return e},[])},L=(e,t)=>{const s=he(e);for(const r of E(e,t)){const e=s.watchers.find(e=>{const t=e.path===r.path,s=e.signature===r.signature;return t&&s});e&&e.unwatch(),s.watchers.push(r.start())}return s},Q=e=>{const{space:t,name:s}=J(e);return void 0!==s?t in x.spaces&&"stores"in x.spaces[t]&&s in x.spaces[t].stores:t in x.spaces},X=e=>{},Y=(e,t,...s)=>{const{store:r}=ye(e);if(t in r.actions)try{return r.actions[t](...s)}catch(e){console.error(`Something went wrong with the action '${t}'`),console.error(e)}else console.warn(`Couldn't find the action '${t}' to run.`)},Z=(e,t,...s)=>{const{store:r}=ye(e);if(t in r.getters)try{return"function"==typeof r.getters[t]?r.getters[t](...s):r.getters[t]}catch(e){console.error(`Something went wrong with the getter '${t}'`),console.error(e)}else console.warn(`Couldn't find the getter '${t}' to resolve.`)},ee=(e,t,s)=>{const{space:r,name:n}=J(e),o=he({space:r,name:n});return b(o,t,s)},te=(e,t,s)=>{const r=he(e);return v(r,t,s)},se=(e,t,s,r)=>{const{space:n,name:o}=J(e),a=he({space:n,name:o});return k(a,t,s)||r},re=(e,t,s,r)=>function(){return se(e,t,s||this,r)},ne=(e,t,s,r)=>{const n=he(e);S(n,t,s,r)},oe=(e,t,s)=>function(r){ne(e,t,r,s||this)},ae=(e,t,s,r)=>{const n=he(e);j(n,t,s,r)},ce=(e,t,s,r)=>{const n=he(e);O(n,t,s,r)},ie=(e,t,s,r)=>{const n=he(e);w(n,t,s,r)},ue=(e,t,r)=>{const n=(t,s)=>({get:re(e,t,s),set:oe(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=n(t,r),e),{}):s.isObject(t)?Object.keys(t).reduce((e,s)=>(e[s]=n(t[s],r),e),{}):n(t,r)},pe=(e={})=>{"function"==typeof e.teddy&&e.teddy(x);for(const t of Object.keys(x.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(x.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},fe=(e=(e=>e))=>({setStore:e(K),makeState:e(M),setState:e(U),applyState:e(N),makeGetters:e(C),setGetters:e(q),makeActions:e(B),setActions:e(D),makeWatchers:e(E),setWatchers:e(L),exists:e(Q),reset:e(X),run:e(Y),resolve:e(Z),remove:e(ee),has:e(te),get:e(se),getter:e(re),set:e(ne),setter:e(oe),sync:e(ue),push:e(ae),unshift:e(ie),insert:e(ce)}),de=(e=z)=>(e in x.spaces||(x.spaces[e]={}),x.spaces[e]),le=(e=z)=>({store:de(e),...fe(t=>(...s)=>t({space:e,name:H},...s))}),he=e=>{const{space:t=z,name:s=H}=J(e);return de(t),"stores"in x.spaces[t]||(x.spaces[t].stores={}),s in x.spaces[t].stores||(x.spaces[t].stores[s]={getters:{},actions:{},watchers:[],options:{},features:{}},N(0,{},x.spaces[t].stores[s])),x.spaces[t].stores[s]},ye=e=>({store:he(e),...fe(t=>(...s)=>t(e,...s))}),me=e=>{t.provide(F,ye(e))},ge=()=>{t.inject(I)},Pe=()=>{t.inject(F)},Se=e=>{if(s.isObject(e)){const s="get"in e&&"function"==typeof e.get,r="set"in e&&"function"==typeof e.set;return s||r?t.computed(e):Object.keys(e).reduce((s,r)=>(s[r]=t.computed(e[r]),s),{})}return t.computed(e)};var ve=Object.freeze({__proto__:null,accessors:W,features:p,Teddy:I,TeddyStore:F,Teddies:x,setStore:K,makeState:M,applyState:N,setState:U,makeGetters:C,setGetters:q,makeActions:B,setActions:D,makeWatchers:E,setWatchers:L,exists:Q,reset:X,run:Y,resolve:Z,remove:ee,has:te,get:se,getter:re,set:ne,setter:oe,push:ae,insert:ce,unshift:ie,sync:ue,setFeature:pe,mapMethods:fe,getTeddy:de,useTeddy:le,getStore:he,useStore:ye,provideTeddyStore:me,injectTeddy:ge,injectTeddyStore:Pe,computed:Se});return e.Teddies=x,e.Teddy=I,e.TeddyStore=F,e.accessors=W,e.applyState=N,e.computed=Se,e.exists=Q,e.features=p,e.get=se,e.getStore=he,e.getTeddy=de,e.getter=re,e.has=te,e.injectTeddy=ge,e.injectTeddyStore=Pe,e.insert=ce,e.install=e=>{e.prototype.$teddy=ve},e.makeActions=B,e.makeGetters=C,e.makeState=M,e.makeWatchers=E,e.mapMethods=fe,e.provideTeddyStore=me,e.push=ae,e.remove=ee,e.reset=X,e.resolve=Z,e.run=Y,e.set=ne,e.setActions=D,e.setFeature=pe,e.setGetters=q,e.setState=U,e.setStore=K,e.setWatchers=L,e.setter=oe,e.sync=ue,e.unshift=ie,e.useStore=ye,e.useTeddy=le,e}({},Vue,objectStringPath,debounce,equal,fnAnnotate);
