/*!
  * vue-teddy-store v0.1.31
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.1.31
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
var VueTeddyStore=function(e,t,s){"use strict";function r(e){if(!t.isObject(e)||t.isObject(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}function o(e){return e.filter(Boolean).filter(e=>e.length>0).join(".")}function n(e,s,o){return t.isValidKey(s)&&(t.isObject(e)||Array.isArray(e))?r(e)&&"value"in e&&s in e.value?(e.value[s]=o,e.value[s]):(e[s]=o,e[s]):e&&null==s?(r(e)&&"value"in e?e.value=o:t.isObject(o)?Object.assign(e,o):e=o,e):void console.log("Couldn't not set "+s)}function i(e,s){return t.isValidKey(s)?r(e)?s in e.value?e.value[s]:e.value:t.isObject(e)||Array.isArray(e)?e[s]:void 0:e&&void 0===s?r(e)?e.value:e:void 0}function a(e,s){return!(!t.isObject(e)&&!Array.isArray(e))&&(!!t.isValidKey(s)&&(!!(r(e)&&e.value&&s in e.value)||(!(!e||!(s in e))||void 0)))}function c(e){return t=>{const[s,...r]=t||[];return s?(e(s),["_stores",s,"state",...r]):[]}}const u=(e=(e=>e))=>t.makeSet({setProp:n,getProp:i,hasProp:a,afterGetSteps:c(e)}),h=(e=(e=>e))=>t.makeHas({getProp:i,hasProp:a,afterGetSteps:c(e)}),d=(e=(e=>e))=>t.makeGet({getProp:i,hasProp:a,afterGetSteps:c(e)}),l=t.makeSet({setProp:n,getProp:i,hasProp:a}),p=t.makeHas({getProp:i,hasProp:a}),f=t.makeGet({getProp:i,hasProp:a});var y=Object.freeze({__proto__:null,makeTeddySet:u,makeTeddyHas:h,makeTeddyGet:d,set:l,has:p,get:f});const g=e=>"teddy:store:"+e;var v={handle({name:e,store:t}){const r=window.localStorage||global.localStorage||{};if(r){const o=r.getItem(g(e));o&&(t.state={...t.state,...JSON.parse(o)}),s.watch(t.state,(t,s)=>{t!==s&&r.setItem(g(e),JSON.stringify(t))},{immediate:!0,deep:!0})}}},m={handle({store:e}){e._history=s.reactive([]),s.watch(e.state,t=>{e._history.push(t)},{immediate:!0,deep:!0})}},_={handle({name:e,store:t}){window&&window.addEventListener("storage",r=>{r.key===g(e)&&(t.state=s.reactive({...t.state,...JSON.parse(r.newValue)}))})}},b=Object.freeze({__proto__:null,cache:v,history:m,sync:_});let w;class j extends Error{constructor(e){super(e),this.name="MissingStoreError"}}class O{constructor(){this._vueInstance=null,this._stores={},this._plugins=b,this.add("@",{state:{}})}add(e,t){const r=function(e,t=[]){return Object.keys(e).reduce((s,r)=>(t.includes(r)||(s[r]=e[r]),s),{})}(t=t||{},["state","getters","actions","watchers"]);this._stores[e]={state:S(t.state),...P(t.getters),...t.actions||{},...r},this[e]=this._stores[e];const n=[];Array.isArray(t.watchers)?n.push(...t.watchers):t.watcher&&n.push(t.watcher);for(let t of n)if("function"==typeof t)s.watch(()=>this._stores[e].state.value,t,{deep:!0});else if(t&&"object"==typeof t&&"handler"in t){const{handler:r,path:n,paths:i=[],...a}=t;n?s.watch(()=>d()(this,o([e,n])),r,{deep:!0,...a}):i.length>0?s.watch(i.map(t=>()=>d()(this,o([e,t]))),r,{deep:!0,...a}):s.watch(()=>this._stores[e].state.value,r,{deep:!0,...a})}return this}exists(e){return e in this._stores}remove(e){e in this&&delete this[e],e in this._stores&&delete this._stores[e]}reset(){for(let e in this._stores)this.remove(e)}use(e={}){return"function"==typeof e.install&&e.install(this),"function"==typeof e.handle&&Object.keys(this._stores).map(t=>e.handle.call(this,{name:t,store:this._stores[t]})),this}activate(e=[]){Array.isArray(e)||(e=[e]);for(let t of e)t in this._plugins&&this.use(this._plugins[t]);return this}attachTo(e){return this._vueInstance=e,this}install(...e){const t=this,[s]=e;if(s.version.startsWith("2")){if(w&&s===w)return;w=s,Object.defineProperty(s.prototype,"$teddy",{get(){return t.attachTo(this)},configurable:!0})}else if(s.version.startsWith("3")){const[s,r]=e;s.provide("teddy",r),Object.defineProperty(s.config.globalProperties,"$teddy",{get(){return t.attachTo(this)},configurable:!0})}}get stores(){return this._stores}has(e,t){return k(e,t)}get(e,t){return A(e,t)}getter(e,t){return $(e,t)}set(e,t,s){return x(e,t,s)}setter(e,t){return G(e,t)}sync(e,t){return T(e,t)}computed(e){return E(e)}}const S=(e={})=>s.isRef(e)?e:s.ref(e),P=e=>(e=e||{},Object.keys(e).reduce((t,s)=>(r(e[s])?t[s]=e[s]:"function"==typeof e[s]&&(t[s]=E(e[s])),t),{})),k=(e,t)=>{const s=w.prototype.$teddy;return h(t=>{if(!s.exists(t))throw new j(`You're trying to use the method .has('${e}', context?) on a store which doesn't exists: '${t}'`)})(s,e,I(t,s))},A=(e,t)=>{const s=w.prototype.$teddy;return d(t=>{if(!s.exists(t))throw new j(`You're trying to use the method .get('${e}', context?) on a store which doesn't exists: '${t}'`)})(s,e,I(t,s))},x=(e,t,s)=>{const r=w.prototype.$teddy;u(t=>{if(!r.exists(t))throw new j(`You're trying to use the method .set('${e}', value, context?) on a store which doesn't exists: '${t}'`)})(r,e,t,I(s,r))},$=(e,t)=>function(){return A(e,t)},G=(e,t)=>function(s){x(e,s,t)},T=(e,s)=>{const r=(e,t)=>({get:$(e,t),set:G(e,t)});return Array.isArray(e)?e.reduce((e,t)=>(e[t]=r(t,s),e),{}):t.isObject(e)?Object.keys(e).reduce((t,o)=>(t[o]=r(e[o],s),t),{}):r(e,s)},E=e=>{if(t.isObject(e)){const t="get"in e&&"function"==typeof e.get,r="set"in e&&"function"==typeof e.set;return t||r?s.computed(e):Object.keys(e).reduce((t,r)=>(t[r]=s.computed(e[r]),t),{})}return s.computed(e)};function I(...e){return e.filter(Boolean).reduce((e,s)=>s instanceof O&&s._vueInstance?s._vueInstance:t.isObject(s)?s:e,{})}var V=Object.freeze({__proto__:null,MissingStoreError:j,default:O,createState:S,createGetters:P,has:k,get:A,set:x,getter:$,setter:G,sync:T,computed:E,resolveContext:I});const{has:M,get:z,set:C,sync:H,computed:J,setter:K,getter:N,createGetters:Y,createState:B,MissingStoreError:W}=V;return e.MissingStoreError=W,e.computed=J,e.createGetters=Y,e.createState=B,e.default=O,e.get=z,e.getter=N,e.has=M,e.objectAccess=y,e.set=C,e.setter=K,e.sync=H,e}({},objectStringPath,vueCompositionApi);
