/*!
  * vue-teddy-store v0.1.31
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.1.31
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
var VueTeddyStore=function(t,e,s){"use strict";const r=t=>"teddy:store:"+t;var a={handle({name:t,store:s}){const a=window.localStorage||global.localStorage||{};if(a){const n=a.getItem(r(t));n&&(s.state={...s.state,...JSON.parse(n)}),e.watch(s.state,(e,s)=>{e!==s&&a.setItem(r(t),JSON.stringify(e))},{immediate:!0,deep:!0})}}},n={handle({store:t}){t._history=e.reactive([]),e.watch(t.state,e=>{t._history.push(e)},{immediate:!0,deep:!0})}},i={handle({name:t,store:s}){window&&window.addEventListener("storage",a=>{a.key===r(t)&&(s.state=e.reactive({...s.state,...JSON.parse(a.newValue)}))})}},c=Object.freeze({__proto__:null,cache:a,history:n,sync:i});function o(t){if(!s.isObject(t)||s.isObject(t)&&!("value"in t))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(t,"value").get}function l(t){return t.filter(Boolean).filter(t=>t.length>0).join(".")}function u(t,e){return s.isValidKey(e)?o(t)?e in t.value?t.value[e]:t.value:s.isObject(t)||Array.isArray(t)?t[e]:void 0:t&&void 0===e?o(t)?t.value:t:void 0}function h(t,e){return!(!s.isObject(t)&&!Array.isArray(t))&&(!!s.isValidKey(e)&&(!!(o(t)&&t.value&&e in t.value)||(!(!t||!(e in t))||void 0)))}const d=s.makeSet({setProp:function(t,e,r){return s.isValidKey(e)&&(s.isObject(t)||Array.isArray(t))?o(t)&&"value"in t&&e in t.value?(t.value[e]=r,t.value[e]):(t[e]=r,t[e]):t&&null==e?(o(t)&&"value"in t?t.value=r:s.isObject(r)?Object.assign(t,r):t=r,t):void console.log("Couldn't not set "+e)},getProp:u,hasProp:h}),y=s.makeHas({getProp:u,hasProp:h}),f=s.makeGet({getProp:u,hasProp:h});var p=Object.freeze({__proto__:null,set:d,has:y,get:f});function g(...t){return t.filter(Boolean).reduce((t,e)=>e instanceof v?e:s.isObject(e)&&e.$teddy instanceof v?e.$teddy:t,null)}function _(...t){return t.filter(Boolean).reduce((t,e)=>e instanceof v&&e._vueInstance?e._vueInstance:s.isObject(e)?e:t,{})}class v{constructor(){this._vueInstance=null,this._stores={},this._plugins=c}add(t,s){const r=function(t,e=[]){return Object.keys(t).reduce((s,r)=>(e.includes(r)||(s[r]=t[r]),s),{})}(s,["state","getters","actions","watchers"]);this._stores[t]={state:v.createState(s.state),...v.createGetters(s.getters),...s.actions||{},...r},this[t]=this._stores[t];const a=[];Array.isArray(s.watchers)?a.push(...s.watchers):s.watcher&&a.push(s.watcher);for(let s of a)if("function"==typeof s)e.watch(()=>this._stores[t].state.value,s,{deep:!0});else if(s&&"object"==typeof s&&"handler"in s){const{handler:r,path:a,paths:n=[],...i}=s;a?e.watch(()=>f(this._stores[t].state.value,a),r,{deep:!0,...i}):n.length>0?e.watch(n.map(e=>()=>f(this._stores[t].state.value,e)),r,{deep:!0,...i}):e.watch(()=>this._stores[t].state.value,r,{deep:!0,...i})}return this}remove(t){t in this&&delete this[t],t in this._stores&&delete this._stores[t]}use(t={}){return"function"==typeof t.install&&t.install(this),"function"==typeof t.handle&&Object.keys(this._stores).map(e=>t.handle.call(this,{name:e,store:this._stores[e]})),this}activate(t=[]){Array.isArray(t)||(t=[t]);for(let e of t)e in this._plugins&&this.use(this._plugins[e]);return this}attachTo(t){return this._vueInstance=t,this}install(t){const e=this;Object.defineProperty(t.prototype,"$teddy",{get(){return e.attachTo(this)},configurable:!0})}get stores(){return this._stores}static createState(t={}){return e.isRef(t)?t:e.ref(t)}static createGetters(t){return t=t||{},Object.keys(t).reduce((s,r)=>(o(t[r])?s[r]=t[r]:"function"==typeof t[r]&&(s[r]=e.computed(t[r])),s),{})}has(t,e,s){return v.has.call(this,t,e,s)}static has(t,e,s){return y(g(this,s),l([`_stores.${t}.state`,e]),_(s,this))}get(t,e,s){return v.get.call(this,t,e,s)}static get(t,e,s){return f(g(this,s),l([`_stores.${t}.state`,e]),_(s,this))}getter(t,e,s){return v.getter.call(this,t,e,s)}static getter(t,e,s){const r=this;return function(){return v.get.call(g(this,r,s),t,e,s||this)}}set(t,e,s,r){return v.set.call(this,t,e,s,r)}static set(t,e,s,r){d(g(this,r),l([`_stores.${t}.state`,e]),s,_(r,this))}setter(t,e,s){return v.setter.call(this,t,e,s)}static setter(t,e,s){const r=this;return function(a){v.set.call(g(this,r,s),t,e,a,s||this)}}_sync(t,e,s){return v._sync.call(this,t,e,s)}static _sync(t,e,s){return{get:v.getter.call(this,t,e,s),set:v.setter.call(this,t,e,s)}}sync(t,e,s){return v.sync.call(this,t,e,s)}static sync(t,r,a){const n=this,i=null==n,c=t=>i?e.computed(t):t;return Array.isArray(r)?r.reduce((e,s)=>(e[s]=c(v._sync.call(n,t,s,a)),e),{}):s.isObject(r)?Object.keys(r).reduce((e,s)=>(e[s]=c(v._sync.call(n,t,r[s],a)),e),{}):c(v._sync.call(n,t,r,a))}}const{get:b,set:j,sync:O,setter:w,getter:m,createGetters:A,createState:S}=v;return t.createGetters=A,t.createState=S,t.default=v,t.get=b,t.getter=m,t.objectAccess=p,t.set=j,t.setter=w,t.sync=O,t}({},vueCompositionApi,objectStringPath);
