/*!
  * vue-teddy-store v0.1.21
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.1.21
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
var VueTeddyStore=function(t){"use strict";const e=t=>"teddy:store:"+t;var r={handle({name:r,store:n}){const s=window.localStorage||global.localStorage||{};if(s){const i=s.getItem(e(r));i&&(n.state={...n.state,...JSON.parse(i)}),t.watch(n.state,(t,n)=>{t!==n&&s.setItem(e(r),JSON.stringify(t))},{immediate:!0,deep:!0})}}},n=Object.freeze({__proto__:null,prefix:e,default:r}),s={handle({store:e}){e._history=t.reactive([]),t.watch(e.state,t=>{e._history.push(t)},{immediate:!0,deep:!0})}},i=Object.freeze({__proto__:null,default:s}),o={handle({name:r,store:n}){window&&window.addEventListener("storage",s=>{s.key===e(r)&&(n.state=t.reactive({...n.state,...JSON.parse(s.newValue)}))})}},a=Object.freeze({__proto__:null,default:o}),c=Object.freeze({__proto__:null,cache:n,history:i,sync:a});const u=/({.+?})/gim;function l(t){return e=>{e=e.slice(1,-1).trim();const r=y(t,e);if(["string","number"].includes(typeof r))return r;throw new Error(`Couldn't not find any proper value for ${r} at ${e}`)}}function h(t){let e,r;function n(t){return"[object Object]"===Object.prototype.toString.call(t)}return!1!==n(t)&&(e=t.constructor,void 0===e||(r=e.prototype,!1!==n(r)))}function f(t){if(!h(t)||h(t)&&!("value"in t))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(t,"value").get}function p(t,e){return!(!h(t)&&!Array.isArray(t))&&(!(!f(t)||!(e in t.value))||e in t)}function d(t,e){if(h(t)||Array.isArray(t))return f(t)?e&&e in t.value?t.value[e]:t.value:e&&e in t?t[e]:t}function y(t,e,r,n){return function t(e,r,n){if(r.length>0){const s=r.shift();if(p(e,s)){return t(d(e,s),r,n)}return n}return e}(t,String(e).replace(/\[/g,".").replace(/]/g,"").replace(u,l(n)).split("."),r)}function _(t,e,r){return f(t)&&e in t.value?(t.value[e]=r,t.value[e]):(t[e]=r,t[e])}function g(t){const e=t.filter(t=>t&&h(t)&&t instanceof w),r=t.filter(t=>t&&h(t)&&"$teddy"in t&&t.$teddy instanceof w),n=t.filter(t=>!e.includes(t)&&!r.includes(t));return{instances:e,hosted:r,others:n}}function m(...t){const{instances:e,hosted:r}=g(t),n=[...e,...r.map(t=>t.$teddy)];if(0===!e.length)throw new Error("Couldn't find any proper instance!");return n[0]}function v(...t){const{hosted:e,others:r}=g(t),n=[...e,...r];if(0===!n.length)throw new Error("Couldn't find any proper context!");return n[0]}class w{constructor(){this._stores={},this._plugins=c}add(e,r){const n=function(t,e=[]){return Object.keys(t).reduce((r,n)=>(n.includes(e)||(r[n]=t[n]),r),{})}(r,["state","methods","watchers"]);this._stores[e]={...w.createState(r.state),...r.methods||{},...n};const s=[];Array.isArray(r.watchers)?s.push(...r.watchers):r.watcher&&s.push(r.watcher);for(let r of s)if("function"==typeof r)t.watch(()=>this._stores[e].state.value,r,{deep:!0});else if(r&&"object"==typeof r&&"handler"in r){const{handler:n,path:s,paths:i=[],...o}=r;s?t.watch(()=>y(this._stores[e].state.value,s),n,{deep:!0,...o}):i.length>0?t.watch(i.map(t=>()=>y(this._stores[e].state.value,t)),n,{deep:!0,...o}):t.watch(()=>this._stores[e].state.value,n,{deep:!0,...o})}return this}use(t={}){return"function"==typeof t.install&&t.install(this),"function"==typeof t.handle&&Object.keys(this._stores).map(e=>t.handle.call(this,{name:e,store:this._stores[e]})),this}activate(t=[]){Array.isArray(t)||(t=[t]);for(let e of t)e in this._plugins&&this.use(this._plugins[e]);return this}install(t){t.prototype.$teddy=this}get stores(){return this._stores}static createState(e){return t.isRef(e)?e:t.ref(e)}get(t,e){return w.get(t,e,this)}static get(t,e,r){return r=r||this,function(){const n=m(this,r),s=v(this,r);return y(n,`_stores.${t}.state.${e}`,void 0,s)}}set(t,e){return w.set(t,e,this)}static set(t,e,r){return r=r||this,function(n){const s=m(this,r),i=v(this,r);!function(t,e,r,n){const s=String(e).replace(/\[/g,".").replace(/]/g,"").replace(u,l(n)).split("."),i=(t,e,r)=>{const n=e.shift().replace(/^\^/,"");if(e.length>0){const s=e[0];if(Number.isInteger(+s)){if(!p(t,n)||!Array.isArray(d(t,n)))return i(_(t,n,[]),e,r);i(d(t,n),e,r)}else{if(!p(t,n)||!h(d(t,n)))return i(_(t,n,{}),e,r);i(d(t,n),e,r)}}else _(t,n,r)};s.length>0?i(t,s,r):t.value?t.value=r:t=r}(s,`_stores.${t}.state.${e}`,n,i)}}compute(t,e){return w.compute(t,e,this)}static _compute(t,e,r){r=r||this;return{get:w.get(t,e,r),set:w.set(t,e,r)}}static compute(t,e,r){return r=r||this,h(e)?Object.keys(e).reduce((n,s)=>(n[s]=w._compute(t,e[s],r),n),{}):w._compute(t,e,r)}}return w}(vueCompositionApi);
