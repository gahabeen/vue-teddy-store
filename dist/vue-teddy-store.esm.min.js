/*!
  * vue-teddy-store v0.2.39
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.2.39
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
import e,{reactive as t,unref as s,isRef as r,ref as n,provide as a,inject as o,computed as c,watch as i}from"@vue/composition-api";import{isObject as p,makeSet as u,makeHas as d,makeGet as l,makeRemove as f,isValidKey as y}from"object-string-path";import"object-hash";import"fast-safe-stringify";import h from"vue";const m=(e,t)=>`teddy:${e}:${t}`;var g={store(e,t){const s=le({space:e,name:t});if(s.features.cache)return;const r=window.localStorage||global.localStorage||{};if(r){const n=r.getItem(m(e,t));n&&(s.state=JSON.parse(n)),X({space:e,name:t},{handler(s){r.setItem(m(e,t),JSON.stringify(s))},immediate:!0,deep:!0}),s.features.cache=!0}}},v={store(e,s){const r=le({space:e,name:s});r.features.history||(r.features.history={},r.features.history.stack=t([]),X({space:e,name:s},{handler(e){r.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),r.features.history.installed=!0)}},S={store(e,t){const s=le({space:e,name:t});s.features.sync||(s.features.sync={},window&&window.addEventListener("storage",e=>{e.key===m(t)&&(s.state={...s.state,...JSON.parse(e.newValue)})}),s.features.sync.installed=!0)}},P=Object.freeze({__proto__:null,cache:g,history:v,sync:S});function b(e){if(!p(e)||p(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}function j(e,t,s){return y(t)&&(p(e)||Array.isArray(e))?b(e)&&"value"in e&&t in e.value?(e.value[t]=s,e.value[t]):Array.isArray(e)?(e.splice(+t,1,s),e[t]):p(e)?(e[t]=s,e[t]):void 0:e&&null==t?(b(e)&&"value"in e?e.value=s:p(s)?Object.assign(e,s):e=s,e):void console.warn("Couldn't not set "+t)}function w(e,t){return y(t)?b(e)?t in e.value?e.value[t]:e.value:p(e)||Array.isArray(e)?e[t]:void 0:e&&void 0===t?b(e)?e.value:e:void 0}function _(e,t){return!(!p(e)&&!Array.isArray(e))&&(!!y(t)&&(!!(b(e)&&e.value&&t in e.value)||(!(!e||!(t in e))||void 0)))}function k(e,t,n,a){const o=s(t),c=r(t);return Array.isArray(o)?(c?t.value.splice(+a,1):t.splice(+a,1),!0):!!p(o)&&(c?t.value=function(e,t=[]){return Object.keys(e).reduce((s,r)=>(t.includes(r)||(s[r]=e[r]),s),{})}(t.value,[a]):delete t[a],n.length,!0)}function A(e=[]){return"_state"!==e[0]?["_state",...e]:e}const O=u({setProp:j,getProp:w,hasProp:_,afterGetSteps:A}),G=d({getProp:w,hasProp:_,afterGetSteps:A}),T=(e,t)=>l({getProp:w,hasProp:_,afterGetSteps:A}),$=(e,t)=>f({get:T(),getProp:w,hasProp:_,removeProp:k,afterGetSteps:A}),W=u({setProp:j,getProp:w,hasProp:_}),x=d({getProp:w,hasProp:_}),z=l({getProp:w,hasProp:_}),J=f({get:z,getProp:w,hasProp:_});var N=Object.freeze({__proto__:null,teddySet:O,teddyHas:G,teddyGet:T,teddyRemove:$,set:W,has:x,get:z,remove:J});h.use(e);const C=Symbol(),D=Symbol(),I={__options:{devtools:!0},spaces:{}},B="$",E="@",F=e=>{let t,s;if(p(e))t="space"in e?e.space:B,s="name"in e?e.name:E;else if("string"==typeof e)if(e.includes(".")){let[r,n]=e.split(".");t=r,s=n}else if(e.includes("/")){let[r,n]=e.split("/");t=r,s=n}else t=B,s=e;return"string"==typeof t&&(t=t.trim(),0===t.length&&(t=void 0)),"string"==typeof s&&(s=s.trim(),0===s.length&&(s=void 0)),{space:t,name:s}},H=(e,t)=>{const s=F(e);t=t||{};const r=le(s);return R(s,t.state),q(s,t.getters),Q(s,t.actions),X(s,t.watchers),r},L=(e,t)=>r(t)?t:n(t),M=(e,t,s={})=>(s._state=L(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),R=(e,t)=>{const s=le(e);M(0,t,s)},V=(e,t)=>{const s=le(e);return t=t||{},Object.keys(t).reduce((e,r)=>(b(t[r])?e[r]=t[r]:"function"==typeof t[r]&&(e[r]=ge(()=>t[r](s))),e),{})},q=(e,t)=>{const s=le(e);return s.getters={...s.getters||{},...V(e,t)},s},K=(e,t)=>{const s=le(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},Q=(e,t)=>{const s=le(e);return s.actions={...s.actions||{},...K(e,t)},s},U=(e,t)=>{const{space:s,name:r}=F(e),n=le(e),a=[];return Array.isArray(t)?a.push(...t):t&&a.push(t),0===a.length?[]:a.reduce((e,t)=>{const s=(t,s,r,n)=>{const a=i(s,r,{deep:!0,...n});e.push({path:t,handler:r,options:n,unwatch:a})};if("function"==typeof t)s("state",()=>n.state,t,{deep:!0});else if(t&&"object"==typeof t&&"handler"in t){const{handler:e,path:a,paths:o=[],...c}=t,i=e=>function(t,s){(void 0!==t&&void 0!==s||t!==s)&&e.call(this,t,s)};"string"==typeof a?s(a,()=>T()(n,a),i(e),{deep:!0,...c}):o.length>0?s(o.map(e=>[r,e].filter(Boolean).filter(e=>e.length>0).join(".")),o.map(e=>()=>T()(n,e)),i(e),{deep:!0,...c}):s("state",()=>n.state,i(e),{deep:!0,...c})}return e},[])},X=(e,t)=>{const s=le(e);return s.watchers=[...s.watchers||[],...U(e,t)],s},Y=e=>{const{space:t,name:s}=F(e);return void 0!==s?t in I.spaces&&"stores"in I.spaces[t]&&s in I.spaces[t].stores:t in I.spaces},Z=e=>{},ee=(e,t,...s)=>{const{store:r}=fe(e);if(t in r.actions)try{return r.actions[t](...s)}catch(e){console.error(`Something went wrong with the action '${t}'`),console.error(e)}else console.warn(`Couldn't find the action '${t}' to run.`)},te=(e,t,s)=>{const{space:r,name:n}=F(e),a=le({space:r,name:n});return $()(a,t,s)},se=(e,t,s)=>{const r=le(e);return G(r,t,s)},re=(e,t,s,r)=>{const{space:n,name:a}=F(e),o=le({space:n,name:a});return T()(o,t,s)||r},ne=(e,t,s,r)=>function(){return re(e,t,s||this,r)},ae=(e,t,s,r)=>{const n=le(e);O(n,t,s,r)},oe=(e,t,s)=>function(r){ae(e,t,r,s||this)},ce=(e,t,s)=>{const r=(t,s)=>({get:ne(e,t,s),set:oe(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=r(t,s),e),{}):p(t)?Object.keys(t).reduce((e,n)=>(e[n]=r(t[n],s),e),{}):r(t,s)},ie=(e={})=>{"function"==typeof e.teddy&&e.teddy(I);for(const t of Object.keys(I.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(I.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},pe=(e=(e=>e))=>({setStore:e(H),makeState:e(L),setState:e(R),applyState:e(M),makeGetters:e(V),setGetters:e(q),makeActions:e(K),setActions:e(Q),makeWatchers:e(U),setWatchers:e(X),exists:e(Y),reset:e(Z),run:e(ee),remove:e(te),has:e(se),get:e(re),getter:e(ne),set:e(ae),setter:e(oe),sync:e(ce)}),ue=(e=B)=>(e in I.spaces||(I.spaces[e]={}),I.spaces[e]),de=(e=B)=>({store:ue(e),...pe(t=>(...s)=>t({space:e,name:E},...s))}),le=e=>{const{space:t=B,name:s=E}=F(e);return ue(t),"stores"in I.spaces[t]||(I.spaces[t].stores={}),s in I.spaces[t].stores||(I.spaces[t].stores[s]={getters:{},actions:{},watchers:[],options:{},features:{}},M(0,{},I.spaces[t].stores[s])),I.spaces[t].stores[s]},fe=e=>({store:le(e),...pe(t=>(...s)=>t(e,...s))}),ye=e=>{a(D,fe(e))},he=()=>{o(C)},me=()=>{o(D)},ge=e=>{if(p(e)){const t="get"in e&&"function"==typeof e.get,s="set"in e&&"function"==typeof e.set;return t||s?c(e):Object.keys(e).reduce((t,s)=>(t[s]=c(e[s]),t),{})}return c(e)};var ve=Object.freeze({__proto__:null,accessors:N,features:P,Teddy:C,TeddyStore:D,Teddies:I,setStore:H,makeState:L,applyState:M,setState:R,makeGetters:V,setGetters:q,makeActions:K,setActions:Q,makeWatchers:U,setWatchers:X,exists:Y,reset:Z,run:ee,remove:te,has:se,get:re,getter:ne,set:ae,setter:oe,sync:ce,setFeature:ie,mapMethods:pe,getTeddy:ue,useTeddy:de,getStore:le,useStore:fe,provideTeddyStore:ye,injectTeddy:he,injectTeddyStore:me,computed:ge});const Se=e=>{e.prototype.$teddy=ve};export{I as Teddies,C as Teddy,D as TeddyStore,N as accessors,M as applyState,ge as computed,Y as exists,P as features,re as get,le as getStore,ue as getTeddy,ne as getter,se as has,he as injectTeddy,me as injectTeddyStore,Se as install,K as makeActions,V as makeGetters,L as makeState,U as makeWatchers,pe as mapMethods,ye as provideTeddyStore,te as remove,Z as reset,ee as run,ae as set,Q as setActions,ie as setFeature,q as setGetters,R as setState,H as setStore,X as setWatchers,oe as setter,ce as sync,fe as useStore,de as useTeddy};
