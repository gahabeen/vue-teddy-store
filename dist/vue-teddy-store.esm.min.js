/*!
  * vue-teddy-store v0.2.41
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.2.41
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
import e,{reactive as t,set as s,unref as r,isRef as n,ref as o,provide as a,inject as c,computed as i,watch as p}from"@vue/composition-api";import{isObject as u,makeSet as d,makeHas as f,makeGet as l,makeRemove as y,isValidKey as h}from"object-string-path";import m from"vue";const g=(e,t)=>`teddy:${e}:${t}`;var v={store(e,t){const s=le({space:e,name:t});if(s.features.cache)return;const r=window.localStorage||global.localStorage||{};if(r){const n=r.getItem(g(e,t));n&&(s.state=JSON.parse(n)),Y({space:e,name:t},{handler(s){r.setItem(g(e,t),JSON.stringify(s))},immediate:!0,deep:!0}),s.features.cache=!0}}},S={store(e,s){const r=le({space:e,name:s});r.features.history||(r.features.history={},r.features.history.stack=t([]),Y({space:e,name:s},{handler(e){r.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),r.features.history.installed=!0)}},P={store(e,t){const s=le({space:e,name:t});s.features.sync||(s.features.sync={},window&&window.addEventListener("storage",r=>{r.key===g(e,t)&&(s.state={...s.state,...JSON.parse(r.newValue)})}),s.features.sync.installed=!0)}},b=Object.freeze({__proto__:null,cache:v,history:S,sync:P});function k(e){if(!u(e)||u(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}function _(e,t,o){if(u(e)||Array.isArray(e)){if(h(t)){try{s(r(e),t,o)}catch(s){console.error("Couldn't not set value: "+{obj:e,key:t,value:o})}return r(e)[t]}n(e)?e.value=o:e=o}}function j(e,t){if(u(e)||Array.isArray(e))return h(t)?n(e)?t in e.value?e.value[t]:e.value:e[t]:n(e)?e.value:e}function w(e,t){return!(!u(e)&&!Array.isArray(e))&&(!!h(t)&&(!!(k(e)&&e.value&&t in e.value)||(!(!e||!(t in e))||void 0)))}function A(e,t,s,o){const a=r(t),c=n(t);return Array.isArray(a)?(c?t.value.splice(+o,1):t.splice(+o,1),!0):!!u(a)&&(c?t.value=function(e,t=[]){return Object.keys(e).reduce((s,r)=>(t.includes(r)||(s[r]=e[r]),s),{})}(t.value,[o]):delete t[o],s.length,!0)}function O(e=[]){return"_state"!==e[0]?["_state",...e]:e}const G=d({setProp:_,getProp:j,hasProp:w,afterGetSteps:O}),T=f({getProp:j,hasProp:w,afterGetSteps:O}),$=(e,t)=>l({getProp:j,hasProp:w,afterGetSteps:O}),W=(e,t)=>y({get:$(),getProp:j,hasProp:w,removeProp:A,afterGetSteps:O}),x=d({setProp:_,getProp:j,hasProp:w}),z=f({getProp:j,hasProp:w}),J=l({getProp:j,hasProp:w}),N=y({get:J,getProp:j,hasProp:w});var C=Object.freeze({__proto__:null,teddySet:G,teddyHas:T,teddyGet:$,teddyRemove:W,set:x,has:z,get:J,remove:N});m.use(e);const D=Symbol(),I=Symbol(),B={__options:{devtools:!0},spaces:{}},E="$",F="@",H=e=>{let t,s;if(u(e))t="space"in e?e.space:E,s="name"in e?e.name:F;else if("string"==typeof e)if(e.includes(".")){let[r,n]=e.split(".");t=r,s=n}else if(e.includes("/")){let[r,n]=e.split("/");t=r,s=n}else t=E,s=e;return"string"==typeof t&&(t=t.trim(),0===t.length&&(t=void 0)),"string"==typeof s&&(s=s.trim(),0===s.length&&(s=void 0)),{space:t,name:s}},L=(e,t)=>{const s=H(e);t=t||{};const r=le(s);return V(s,t.state),K(s,t.getters),U(s,t.actions),Y(s,t.watchers),r},M=(e,t)=>n(t)?t:o(t),R=(e,t,s={})=>(s._state=M(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),V=(e,t)=>{const s=le(e);R(0,t,s)},q=(e,t)=>{const s=le(e);return t=t||{},Object.keys(t).reduce((e,r)=>(k(t[r])?e[r]=t[r]:"function"==typeof t[r]&&(e[r]=ve(()=>t[r](s))),e),{})},K=(e,t)=>{const s=le(e);return s.getters={...s.getters||{},...q(e,t)},s},Q=(e,t)=>{const s=le(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},U=(e,t)=>{const s=le(e);return s.actions={...s.actions||{},...Q(e,t)},s},X=(e,t)=>{const{space:s,name:r}=H(e),n=le(e),o=[];return Array.isArray(t)?o.push(...t):t&&o.push(t),0===o.length?[]:o.reduce((e,t)=>{const s=(t,s,r,n)=>{const o=p(s,r,{deep:!0,...n});e.push({path:t,handler:r,options:n,unwatch:o})};if("function"==typeof t)s("state",()=>n.state,t,{deep:!0});else if(t&&"object"==typeof t&&"handler"in t){const{handler:e,path:o,paths:a=[],...c}=t,i=e=>function(t,s){(void 0!==t&&void 0!==s||t!==s)&&e.call(this,t,s)};"string"==typeof o?s(o,()=>$()(n,o),i(e),{deep:!0,...c}):a.length>0?s(a.map(e=>[r,e].filter(Boolean).filter(e=>e.length>0).join(".")),a.map(e=>()=>$()(n,e)),i(e),{deep:!0,...c}):s("state",()=>n.state,i(e),{deep:!0,...c})}return e},[])},Y=(e,t)=>{const s=le(e);return s.watchers=[...s.watchers||[],...X(e,t)],s},Z=e=>{const{space:t,name:s}=H(e);return void 0!==s?t in B.spaces&&"stores"in B.spaces[t]&&s in B.spaces[t].stores:t in B.spaces},ee=e=>{},te=(e,t,...s)=>{const{store:r}=ye(e);if(t in r.actions)try{return r.actions[t](...s)}catch(e){console.error(`Something went wrong with the action '${t}'`),console.error(e)}else console.warn(`Couldn't find the action '${t}' to run.`)},se=(e,t,s)=>{const{space:r,name:n}=H(e),o=le({space:r,name:n});return W()(o,t,s)},re=(e,t,s)=>{const r=le(e);return T(r,t,s)},ne=(e,t,s,r)=>{const{space:n,name:o}=H(e),a=le({space:n,name:o});return $()(a,t,s)||r},oe=(e,t,s,r)=>function(){return ne(e,t,s||this,r)},ae=(e,t,s,r)=>{const n=le(e);G(n,t,s,r)},ce=(e,t,s)=>function(r){ae(e,t,r,s||this)},ie=(e,t,s)=>{const r=(t,s)=>({get:oe(e,t,s),set:ce(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=r(t,s),e),{}):u(t)?Object.keys(t).reduce((e,n)=>(e[n]=r(t[n],s),e),{}):r(t,s)},pe=(e={})=>{"function"==typeof e.teddy&&e.teddy(B);for(const t of Object.keys(B.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(B.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},ue=(e=(e=>e))=>({setStore:e(L),makeState:e(M),setState:e(V),applyState:e(R),makeGetters:e(q),setGetters:e(K),makeActions:e(Q),setActions:e(U),makeWatchers:e(X),setWatchers:e(Y),exists:e(Z),reset:e(ee),run:e(te),remove:e(se),has:e(re),get:e(ne),getter:e(oe),set:e(ae),setter:e(ce),sync:e(ie)}),de=(e=E)=>(e in B.spaces||(B.spaces[e]={}),B.spaces[e]),fe=(e=E)=>({store:de(e),...ue(t=>(...s)=>t({space:e,name:F},...s))}),le=e=>{const{space:t=E,name:s=F}=H(e);return de(t),"stores"in B.spaces[t]||(B.spaces[t].stores={}),s in B.spaces[t].stores||(B.spaces[t].stores[s]={getters:{},actions:{},watchers:[],options:{},features:{}},R(0,{},B.spaces[t].stores[s])),B.spaces[t].stores[s]},ye=e=>({store:le(e),...ue(t=>(...s)=>t(e,...s))}),he=e=>{a(I,ye(e))},me=()=>{c(D)},ge=()=>{c(I)},ve=e=>{if(u(e)){const t="get"in e&&"function"==typeof e.get,s="set"in e&&"function"==typeof e.set;return t||s?i(e):Object.keys(e).reduce((t,s)=>(t[s]=i(e[s]),t),{})}return i(e)};var Se=Object.freeze({__proto__:null,accessors:C,features:b,Teddy:D,TeddyStore:I,Teddies:B,setStore:L,makeState:M,applyState:R,setState:V,makeGetters:q,setGetters:K,makeActions:Q,setActions:U,makeWatchers:X,setWatchers:Y,exists:Z,reset:ee,run:te,remove:se,has:re,get:ne,getter:oe,set:ae,setter:ce,sync:ie,setFeature:pe,mapMethods:ue,getTeddy:de,useTeddy:fe,getStore:le,useStore:ye,provideTeddyStore:he,injectTeddy:me,injectTeddyStore:ge,computed:ve});const Pe=e=>{e.prototype.$teddy=Se};export{B as Teddies,D as Teddy,I as TeddyStore,C as accessors,R as applyState,ve as computed,Z as exists,b as features,ne as get,le as getStore,de as getTeddy,oe as getter,re as has,me as injectTeddy,ge as injectTeddyStore,Pe as install,Q as makeActions,q as makeGetters,M as makeState,X as makeWatchers,ue as mapMethods,he as provideTeddyStore,se as remove,ee as reset,te as run,ae as set,U as setActions,pe as setFeature,K as setGetters,V as setState,L as setStore,Y as setWatchers,ce as setter,ie as sync,ye as useStore,fe as useTeddy};
