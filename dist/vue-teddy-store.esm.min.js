/*!
  * vue-teddy-store v0.1.36
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.1.36
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
import{getTeddyStore as e,setWatchers as t}from"@/index";import s,{reactive as r,ref as a,isRef as o,provide as n,inject as c,computed as i,watch as u}from"@vue/composition-api";import{isObject as p,makeSet as d,makeHas as l,makeGet as y,isValidKey as f}from"object-string-path";import m from"vue";const v=(e,t)=>`teddy:${e}:${t}`;var h={store(s,r){const a=e(s,r);if(a.features.cache)return;const o=window.localStorage||global.localStorage||{};if(o){const e=o.getItem(v(s,r));e&&(a.state={...a.state,...JSON.parse(e)}),t({space:s,name:r},{handler(e,t){e!==t&&o.setItem(v(s,r),JSON.stringify(e))},immediate:!0,deep:!0}),a.features.cache=!0}}},g={store(s,a){const o=e(s,a);o.features.history||(o.features.history={},o.features.history.stack=r([]),t({space:s,name:a},{handler(e){o.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),o.features.history.installed=!0)}},S={store(t,s){const r=e(t,s);r.features.sync||(r.features.sync={},window&&window.addEventListener("storage",e=>{e.key===v(s)&&(r.state={...r.state,...JSON.parse(e.newValue)})}),r.features.sync.installed=!0)}},b=Object.freeze({__proto__:null,cache:h,history:g,sync:S});function _(e){if(!p(e)||p(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}function j(e,t,s){return f(t)&&(p(e)||Array.isArray(e))?_(e)&&"value"in e&&t in e.value?(e.value[t]=s,e.value[t]):(e[t]=s,e[t]):e&&null==t?(_(e)&&"value"in e?e.value=s:p(s)?Object.assign(e,s):e=s,e):void console.log("Couldn't not set "+t)}function k(e,t){return f(t)?_(e)?t in e.value?e.value[t]:e.value:p(e)||Array.isArray(e)?e[t]:void 0:e&&void 0===t?_(e)?e.value:e:void 0}function O(e,t){return!(!p(e)&&!Array.isArray(e))&&(!!f(t)&&(!!(_(e)&&e.value&&t in e.value)||(!(!e||!(t in e))||void 0)))}function P(e=[]){return["_state",...e]}const w=d({setProp:j,getProp:k,hasProp:O,afterGetSteps:P}),A=l({getProp:k,hasProp:O,afterGetSteps:P}),T=y({getProp:k,hasProp:O,afterGetSteps:P}),$=d({setProp:j,getProp:k,hasProp:O}),G=l({getProp:k,hasProp:O}),W=y({getProp:k,hasProp:O});var x=Object.freeze({__proto__:null,teddySet:w,teddyHas:A,teddyGet:T,set:$,has:G,get:W});m.use(s);const z=Symbol(),D=Symbol(),J=a({__options:{devtools:!0},spaces:{}}),N=(e="$",t="@")=>{let s=e,r=t;if("string"==typeof e&&e.includes(".")){const t=e.split(".");s=t[0]||s,r=t[1]||r}else e&&p(e)?(s=e.space||s,r=e.name||r):t&&p(t)&&(s=t.space||s,r=t.name||r);return"string"==typeof s&&(s=s.trim()),"string"==typeof r&&(r=r.trim()),{space:s,name:r}},I=(e,t)=>{const s=N(p(e)?e:{name:e});t=t||{};const r=ie(s);return E(s,t.state),H(s,t.getters),M(s,t.actions),q(s,t.watchers),r},B=(e,t)=>o(t)?t:a(t),C=(e,t,s={})=>(s._state=B(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),E=(e,t)=>{const s=ie(e);C(0,t,s)},F=(e,t)=>{const s=ie(e);return t=t||{},Object.keys(t).reduce((e,r)=>(_(t[r])?e[r]=t[r]:"function"==typeof t[r]&&(e[r]=fe(()=>t[r](s))),e),{})},H=(e,t)=>{const s=ie(e);return s.getters={...s.getters||{},...F(e,t)},s},L=(e,t)=>{const s=ie(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},M=(e,t)=>{const s=ie(e);return s.actions={...s.actions||{},...L(e,t)},s},V=(e,t)=>{const{name:s}=N(e),r=ie(e),a=[];return Array.isArray(t)?a.push(...t):t&&a.push(t),0===a.length?[]:a.reduce((e,t)=>{const a=(t,s,r,a)=>{const o=u(s,r,{deep:!0,...a});e.push({path:t,handler:r,options:a,unwatch:o})};if("function"==typeof t)a("state",()=>r.state,t,{deep:!0});else if(t&&"object"==typeof t&&"handler"in t){const{handler:e,path:o,paths:n=[],...c}=t;"string"==typeof o?a(o,()=>T(r,o),e,{deep:!0,...c}):n.length>0?a(n.map(e=>[s,e].filter(Boolean).filter(e=>e.length>0).join(".")),n.map(e=>()=>T(r,e)),e,{deep:!0,...c}):a("state",()=>r.state,e,{deep:!0,...c})}return e},[])},q=(e,t)=>{const s=ie(e);return s.watchers=[...s.watchers||[],...V(e,t)],s},K=e=>{const{space:t,name:s}=N(e);return void 0!==s?t in J.value.spaces&&"stores"in J.value.spaces[t]&&s in J.value.spaces[t].stores:t in J.value.spaces},Q=e=>{const{space:t,name:s}=N(e),r=ae(t);s in r.stores&&delete r.stores[s]},R=e=>{},U=(e,t,s)=>{const r=ie(e);return A(r,t,s)},X=(e,t,s)=>{const r=ie(e);return T(r,t,s)},Y=(e,t,s)=>function(){return X(e,t,s||this)},Z=(e,t,s,r)=>{const a=ie(e);w(a,t,s,r)},ee=(e,t,s)=>function(r){Z(e,t,r,s||this)},te=(e,t,s)=>{const r=(t,s)=>({get:Y(e,t,s),set:ee(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=r(t,s),e),{}):p(t)?Object.keys(t).reduce((e,a)=>(e[a]=r(t[a],s),e),{}):r(t,s)},se=(e={})=>{"function"==typeof e.teddy&&e.teddy(J.value);for(const t of Object.keys(J.value.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(J.value.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},re=(e=(e=>e))=>({setStore:e(I),makeState:e(B),setState:e(E),applyState:e(C),makeGetters:e(F),setGetters:e(H),makeActions:e(L),setActions:e(M),makeWatchers:e(V),setWatchers:e(q),exists:e(K),remove:e(Q),reset:e(R),has:e(U),get:e(X),getter:e(Y),set:e(Z),setter:e(ee),sync:e(te)}),ae=(e="$")=>(e in J.value.spaces||(J.value.spaces[e]={}),J.value.spaces[e]),oe=(e="$")=>({store:ae(e),...re(t=>(...s)=>t({space:e,name:"@"},...s))}),ne=(e="@")=>ie("$",e),ce=(e="@")=>({store:ne(e),...re(t=>(...s)=>t({name:e,space:"$"},...s))}),ie=(e,t)=>{const{space:s,name:r}=N(e,t);return ae(s),"stores"in J.value.spaces[s]||(J.value.spaces[s].stores={}),r in J.value.spaces[s].stores||(J.value.spaces[s].stores[r]={getters:{},actions:{},watchers:[],options:{},features:{}},C(0,{},J.value.spaces[s].stores[r])),J.value.spaces[s].stores[r]},ue=(e="$",t="@")=>({store:ie(e,t),...re(s=>(...r)=>s({space:e,name:t},...r))}),pe=(e="$")=>{n(z,oe(e))},de=(...e)=>{n(D,ue(...e))},le=()=>{c(z)},ye=()=>{c(D)},fe=e=>{if(p(e)){const t="get"in e&&"function"==typeof e.get,s="set"in e&&"function"==typeof e.set;return t||s?i(e):Object.keys(e).reduce((t,s)=>(t[s]=i(e[s]),t),{})}return i(e)};var me=Object.freeze({__proto__:null,accessors:x,features:b,Teddy:z,TeddyStore:D,Teddies:J,parseDefinition:N,setStore:I,makeState:B,applyState:C,setState:E,makeGetters:F,setGetters:H,makeActions:L,setActions:M,makeWatchers:V,setWatchers:q,exists:K,remove:Q,reset:R,has:U,get:X,getter:Y,set:Z,setter:ee,sync:te,setFeature:se,mapMethods:re,getTeddy:ae,useTeddy:oe,getStore:ne,useStore:ce,getTeddyStore:ie,useTeddyStore:ue,provideTeddy:pe,provideTeddyStore:de,injectTeddy:le,injectTeddyStore:ye,computed:fe});const ve=e=>{e.prototype.$teddy=me};export{J as Teddies,z as Teddy,D as TeddyStore,x as accessors,C as applyState,fe as computed,K as exists,b as features,X as get,ne as getStore,ae as getTeddy,ie as getTeddyStore,Y as getter,U as has,le as injectTeddy,ye as injectTeddyStore,ve as install,L as makeActions,F as makeGetters,B as makeState,V as makeWatchers,re as mapMethods,N as parseDefinition,pe as provideTeddy,de as provideTeddyStore,Q as remove,R as reset,Z as set,M as setActions,se as setFeature,H as setGetters,E as setState,I as setStore,q as setWatchers,ee as setter,te as sync,ce as useStore,oe as useTeddy,ue as useTeddyStore};
