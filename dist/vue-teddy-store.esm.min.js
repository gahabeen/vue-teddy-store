/*!
  * vue-teddy-store v0.2.34
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.2.34
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
import e,{reactive as t,isRef as s,ref as r,provide as n,inject as o,computed as a,watch as c}from"@vue/composition-api";import{isObject as i,makeSet as p,makeHas as u,makeGet as d,isValidKey as l}from"object-string-path";import f from"vue";const y=(e,t)=>`teddy:${e}:${t}`;var h={store(e,t){const s=ce({space:e,name:t});if(s.features.cache)return;const r=window.localStorage||global.localStorage||{};if(r){const n=r.getItem(y(e,t));n&&(s.state=JSON.parse(n)),q({space:e,name:t},{handler(s){r.setItem(y(e,t),JSON.stringify(s))},immediate:!0,deep:!0}),s.features.cache=!0}}},m={store(e,s){const r=ce({space:e,name:s});r.features.history||(r.features.history={},r.features.history.stack=t([]),q({space:e,name:s},{handler(e){r.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),r.features.history.installed=!0)}},g={store(e,t){const s=ce({space:e,name:t});s.features.sync||(s.features.sync={},window&&window.addEventListener("storage",e=>{e.key===y(t)&&(s.state={...s.state,...JSON.parse(e.newValue)})}),s.features.sync.installed=!0)}},v=Object.freeze({__proto__:null,cache:h,history:m,sync:g});function S(e){if(!i(e)||i(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}function b(e,t,s){return l(t)&&(i(e)||Array.isArray(e))?S(e)&&"value"in e&&t in e.value?(e.value[t]=s,e.value[t]):Array.isArray(e)?(e.splice(+t,1,s),e[t]):i(e)?(e[t]=s,e[t]):void 0:e&&null==t?(S(e)&&"value"in e?e.value=s:i(s)?Object.assign(e,s):e=s,e):void console.log("Couldn't not set "+t)}function w(e,t){return l(t)?S(e)?t in e.value?e.value[t]:e.value:i(e)||Array.isArray(e)?e[t]:void 0:e&&void 0===t?S(e)?e.value:e:void 0}function _(e,t){return!(!i(e)&&!Array.isArray(e))&&(!!l(t)&&(!!(S(e)&&e.value&&t in e.value)||(!(!e||!(t in e))||void 0)))}function j(e=[]){return["_state",...e]}const k=p({setProp:b,getProp:w,hasProp:_,afterGetSteps:j}),A=u({getProp:w,hasProp:_,afterGetSteps:j}),O=d({getProp:w,hasProp:_,afterGetSteps:j}),P=p({setProp:b,getProp:w,hasProp:_}),T=u({getProp:w,hasProp:_}),G=d({getProp:w,hasProp:_});var $=Object.freeze({__proto__:null,teddySet:k,teddyHas:A,teddyGet:O,set:P,has:T,get:G});f.use(e);const W=Symbol(),x=Symbol(),z={__options:{devtools:!0},spaces:{}},D="$",J="@",N=e=>{let t,s;if(i(e))t="space"in e?e.space:D,s="name"in e?e.name:J;else if("string"==typeof e){if(e.includes(".")){let[r,n]=e.split(".");t=r,s=n}else if(e.includes("/")){let[r,n]=e.split("/");t=r,s=n}else t=D,s=e;console.log("parseDefinition",e,{space:t,name:s})}return"string"==typeof t&&(t=t.trim(),0===t.length&&(t=void 0)),"string"==typeof s&&(s=s.trim(),0===s.length&&(s=void 0)),{space:t,name:s}},C=(e,t)=>{const s=N(e);t=t||{};const r=ce(s);return E(s,t.state),H(s,t.getters),M(s,t.actions),q(s,t.watchers),r},I=(e,t)=>s(t)?t:r(t),B=(e,t,s={})=>(s._state=I(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),E=(e,t)=>{const s=ce(e);B(0,t,s)},F=(e,t)=>{const s=ce(e);return t=t||{},Object.keys(t).reduce((e,r)=>(S(t[r])?e[r]=t[r]:"function"==typeof t[r]&&(e[r]=le(()=>t[r](s))),e),{})},H=(e,t)=>{const s=ce(e);return s.getters={...s.getters||{},...F(e,t)},s},L=(e,t)=>{const s=ce(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},M=(e,t)=>{const s=ce(e);return s.actions={...s.actions||{},...L(e,t)},s},V=(e,t)=>{const{name:s}=N(e),r=ce(e),n=[];return Array.isArray(t)?n.push(...t):t&&n.push(t),0===n.length?[]:n.reduce((e,t)=>{const n=(t,s,r,n)=>{const o=c(s,r,{deep:!0,...n});e.push({path:t,handler:r,options:n,unwatch:o})};if("function"==typeof t)n("state",()=>r.state,t,{deep:!0});else if(t&&"object"==typeof t&&"handler"in t){const{handler:e,path:o,paths:a=[],...c}=t;"string"==typeof o?n(o,()=>O(r,o),e,{deep:!0,...c}):a.length>0?n(a.map(e=>[s,e].filter(Boolean).filter(e=>e.length>0).join(".")),a.map(e=>()=>O(r,e)),e,{deep:!0,...c}):n("state",()=>r.state,e,{deep:!0,...c})}return e},[])},q=(e,t)=>{const s=ce(e);return s.watchers=[...s.watchers||[],...V(e,t)],s},K=e=>{const{space:t,name:s}=N(e);return void 0!==s?t in z.spaces&&"stores"in z.spaces[t]&&s in z.spaces[t].stores:t in z.spaces},Q=e=>{const{space:t,name:s}=N(e),r=oe(t);s in r.stores&&delete r.stores[s]},R=e=>{},U=(e,t,...s)=>{const{store:r}=ie(e);if(t in r.actions)try{return r.actions[t](...s)}catch(e){console.error(`Something went wrong with the action '${t}'`),console.error(e)}else console.warn(`Couldn't find the action '${t}' to run.`)},X=(e,t,s)=>{const r=ce(e);return A(r,t,s)},Y=(e,t,s,r)=>{const n=ce(e);return O(n,t,s)||r},Z=(e,t,s,r)=>function(){return Y(e,t,s||this,r)},ee=(e,t,s,r)=>{const n=ce(e);k(n,t,s,r)},te=(e,t,s)=>function(r){ee(e,t,r,s||this)},se=(e,t,s)=>{const r=(t,s)=>({get:Z(e,t,s),set:te(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=r(t,s),e),{}):i(t)?Object.keys(t).reduce((e,n)=>(e[n]=r(t[n],s),e),{}):r(t,s)},re=(e={})=>{"function"==typeof e.teddy&&e.teddy(z);for(const t of Object.keys(z.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(z.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},ne=(e=(e=>e))=>({setStore:e(C),makeState:e(I),setState:e(E),applyState:e(B),makeGetters:e(F),setGetters:e(H),makeActions:e(L),setActions:e(M),makeWatchers:e(V),setWatchers:e(q),exists:e(K),remove:e(Q),reset:e(R),run:e(U),has:e(X),get:e(Y),getter:e(Z),set:e(ee),setter:e(te),sync:e(se)}),oe=(e=D)=>(e in z.spaces||(z.spaces[e]={}),z.spaces[e]),ae=(e=D)=>({store:oe(e),...ne(t=>(...s)=>t({space:e,name:J},...s))}),ce=e=>{const{space:t=D,name:s=J}=N(e);return oe(t),"stores"in z.spaces[t]||(z.spaces[t].stores={}),s in z.spaces[t].stores||(z.spaces[t].stores[s]={getters:{},actions:{},watchers:[],options:{},features:{}},B(0,{},z.spaces[t].stores[s])),z.spaces[t].stores[s]},ie=e=>({store:ce(e),...ne(t=>(...s)=>t(e,...s))}),pe=e=>{n(x,ie(e))},ue=()=>{o(W)},de=()=>{o(x)},le=e=>{if(i(e)){const t="get"in e&&"function"==typeof e.get,s="set"in e&&"function"==typeof e.set;return t||s?a(e):Object.keys(e).reduce((t,s)=>(t[s]=a(e[s]),t),{})}return a(e)};var fe=Object.freeze({__proto__:null,accessors:$,features:v,Teddy:W,TeddyStore:x,Teddies:z,setStore:C,makeState:I,applyState:B,setState:E,makeGetters:F,setGetters:H,makeActions:L,setActions:M,makeWatchers:V,setWatchers:q,exists:K,remove:Q,reset:R,run:U,has:X,get:Y,getter:Z,set:ee,setter:te,sync:se,setFeature:re,mapMethods:ne,getTeddy:oe,useTeddy:ae,getStore:ce,useStore:ie,provideTeddyStore:pe,injectTeddy:ue,injectTeddyStore:de,computed:le});const ye=e=>{e.prototype.$teddy=fe};export{z as Teddies,W as Teddy,x as TeddyStore,$ as accessors,B as applyState,le as computed,K as exists,v as features,Y as get,ce as getStore,oe as getTeddy,Z as getter,X as has,ue as injectTeddy,de as injectTeddyStore,ye as install,L as makeActions,F as makeGetters,I as makeState,V as makeWatchers,ne as mapMethods,pe as provideTeddyStore,Q as remove,R as reset,U as run,ee as set,M as setActions,re as setFeature,H as setGetters,E as setState,C as setStore,q as setWatchers,te as setter,se as sync,ie as useStore,ae as useTeddy};
