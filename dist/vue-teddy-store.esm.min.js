/*!
  * vue-teddy-store v0.2.37
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.2.37
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
import e,{reactive as t,isRef as s,ref as r,provide as n,inject as o,computed as a,watch as c}from"@vue/composition-api";import{isObject as i,makeSet as p,makeHas as u,makeGet as l,isValidKey as d}from"object-string-path";import f from"object-hash";import y from"fast-safe-stringify";import h from"vue";const m=(e,t)=>`teddy:${e}:${t}`;var g={store(e,t){const s=ue({space:e,name:t});if(s.features.cache)return;const r=window.localStorage||global.localStorage||{};if(r){const n=r.getItem(m(e,t));n&&(s.state=JSON.parse(n)),R({space:e,name:t},{handler(s){r.setItem(m(e,t),JSON.stringify(s))},immediate:!0,deep:!0}),s.features.cache=!0}}},v={store(e,s){const r=ue({space:e,name:s});r.features.history||(r.features.history={},r.features.history.stack=t([]),R({space:e,name:s},{handler(e){r.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),r.features.history.installed=!0)}},S={store(e,t){const s=ue({space:e,name:t});s.features.sync||(s.features.sync={},window&&window.addEventListener("storage",e=>{e.key===m(t)&&(s.state={...s.state,...JSON.parse(e.newValue)})}),s.features.sync.installed=!0)}},w=Object.freeze({__proto__:null,cache:g,history:v,sync:S});function b(e){if(!i(e)||i(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}const j={};function O(e,t,s){return d(t)&&(i(e)||Array.isArray(e))?b(e)&&"value"in e&&t in e.value?(e.value[t]=s,e.value[t]):Array.isArray(e)?(e.splice(+t,1,s),e[t]):i(e)?(e[t]=s,e[t]):void 0:e&&null==t?(b(e)&&"value"in e?e.value=s:i(s)?Object.assign(e,s):e=s,e):void console.warn("Couldn't not set "+t)}function _(e,t){return d(t)?b(e)?t in e.value?e.value[t]:e.value:i(e)||Array.isArray(e)?e[t]:void 0:e&&void 0===t?b(e)?e.value:e:void 0}function k(e,t){return!(!i(e)&&!Array.isArray(e))&&(!!d(t)&&(!!(b(e)&&e.value&&t in e.value)||(!(!e||!(t in e))||void 0)))}function A(e=[]){return["_state",...e]}const P=p({setProp:O,getProp:_,hasProp:k,afterGetSteps:A}),T=u({getProp:_,hasProp:k,afterGetSteps:A}),G=l({getProp:_,hasProp:k,afterGetSteps:A,proxy:(e,t=[],s={},r={},n=(()=>null))=>{const{value:o}=((e,t=[],s={},r={},n=(()=>null))=>{const o=t.join("."),a=f(JSON.parse(y(e))),c=`${o}//${f(JSON.parse(y(r)))}`;if(a in j&&j[a].has(c))return{cache:!0,value:j[a].get(c)};{a in j||(j[a]=new Map);const t=n(e,o,s);return j[a].set(c,t),{cache:!1,value:t}}})(e,t,s,r,n);return o}}),$=p({setProp:O,getProp:_,hasProp:k}),J=u({getProp:_,hasProp:k}),N=l({getProp:_,hasProp:k});var x=Object.freeze({__proto__:null,teddySet:P,teddyHas:T,teddyGet:G,set:$,has:J,get:N});h.use(e);const W=Symbol(),z=Symbol(),C={__options:{devtools:!0},spaces:{}},D="$",I="@",M=e=>{let t,s;if(i(e))t="space"in e?e.space:D,s="name"in e?e.name:I;else if("string"==typeof e)if(e.includes(".")){let[r,n]=e.split(".");t=r,s=n}else if(e.includes("/")){let[r,n]=e.split("/");t=r,s=n}else t=D,s=e;return"string"==typeof t&&(t=t.trim(),0===t.length&&(t=void 0)),"string"==typeof s&&(s=s.trim(),0===s.length&&(s=void 0)),{space:t,name:s}},B=(e,t)=>{const s=M(e);t=t||{};const r=ue(s);return H(s,t.state),V(s,t.getters),K(s,t.actions),R(s,t.watchers),r},E=(e,t)=>s(t)?t:r(t),F=(e,t,s={})=>(s._state=E(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),H=(e,t)=>{const s=ue(e);F(0,t,s)},L=(e,t)=>{const s=ue(e);return t=t||{},Object.keys(t).reduce((e,r)=>(b(t[r])?e[r]=t[r]:"function"==typeof t[r]&&(e[r]=he(()=>t[r](s))),e),{})},V=(e,t)=>{const s=ue(e);return s.getters={...s.getters||{},...L(e,t)},s},q=(e,t)=>{const s=ue(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},K=(e,t)=>{const s=ue(e);return s.actions={...s.actions||{},...q(e,t)},s},Q=(e,t)=>{const{name:s}=M(e),r=ue(e),n=[];return Array.isArray(t)?n.push(...t):t&&n.push(t),0===n.length?[]:n.reduce((e,t)=>{const n=(t,s,r,n)=>{const o=c(s,r,{deep:!0,...n});e.push({path:t,handler:r,options:n,unwatch:o})};if("function"==typeof t)n("state",()=>r.state,t,{deep:!0});else if(t&&"object"==typeof t&&"handler"in t){const{handler:e,path:o,paths:a=[],...c}=t,i=e=>function(t,s){(void 0!==t&&void 0!==s||t!==s)&&e.call(this,t,s)};"string"==typeof o?n(o,()=>G(r,o),i(e),{deep:!0,...c}):a.length>0?n(a.map(e=>[s,e].filter(Boolean).filter(e=>e.length>0).join(".")),a.map(e=>()=>G(r,e)),i(e),{deep:!0,...c}):n("state",()=>r.state,i(e),{deep:!0,...c})}return e},[])},R=(e,t)=>{const s=ue(e);return s.watchers=[...s.watchers||[],...Q(e,t)],s},U=e=>{const{space:t,name:s}=M(e);return void 0!==s?t in C.spaces&&"stores"in C.spaces[t]&&s in C.spaces[t].stores:t in C.spaces},X=e=>{const{space:t,name:s}=M(e),r=ie(t);s in r.stores&&delete r.stores[s]},Y=e=>{},Z=(e,t,...s)=>{const{store:r}=le(e);if(t in r.actions)try{return r.actions[t](...s)}catch(e){console.error(`Something went wrong with the action '${t}'`),console.error(e)}else console.warn(`Couldn't find the action '${t}' to run.`)},ee=(e,t,s)=>{const r=ue(e);return T(r,t,s)},te=(e,t,s,r)=>{const n=ue(e);return G(n,t,s)||r},se=(e,t,s,r)=>function(){return te(e,t,s||this,r)},re=(e,t,s,r)=>{const n=ue(e);P(n,t,s,r)},ne=(e,t,s)=>function(r){re(e,t,r,s||this)},oe=(e,t,s)=>{const r=(t,s)=>({get:se(e,t,s),set:ne(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=r(t,s),e),{}):i(t)?Object.keys(t).reduce((e,n)=>(e[n]=r(t[n],s),e),{}):r(t,s)},ae=(e={})=>{"function"==typeof e.teddy&&e.teddy(C);for(const t of Object.keys(C.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(C.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},ce=(e=(e=>e))=>({setStore:e(B),makeState:e(E),setState:e(H),applyState:e(F),makeGetters:e(L),setGetters:e(V),makeActions:e(q),setActions:e(K),makeWatchers:e(Q),setWatchers:e(R),exists:e(U),remove:e(X),reset:e(Y),run:e(Z),has:e(ee),get:e(te),getter:e(se),set:e(re),setter:e(ne),sync:e(oe)}),ie=(e=D)=>(e in C.spaces||(C.spaces[e]={}),C.spaces[e]),pe=(e=D)=>({store:ie(e),...ce(t=>(...s)=>t({space:e,name:I},...s))}),ue=e=>{const{space:t=D,name:s=I}=M(e);return ie(t),"stores"in C.spaces[t]||(C.spaces[t].stores={}),s in C.spaces[t].stores||(C.spaces[t].stores[s]={getters:{},actions:{},watchers:[],options:{},features:{}},F(0,{},C.spaces[t].stores[s])),C.spaces[t].stores[s]},le=e=>({store:ue(e),...ce(t=>(...s)=>t(e,...s))}),de=e=>{n(z,le(e))},fe=()=>{o(W)},ye=()=>{o(z)},he=e=>{if(i(e)){const t="get"in e&&"function"==typeof e.get,s="set"in e&&"function"==typeof e.set;return t||s?a(e):Object.keys(e).reduce((t,s)=>(t[s]=a(e[s]),t),{})}return a(e)};var me=Object.freeze({__proto__:null,accessors:x,features:w,Teddy:W,TeddyStore:z,Teddies:C,setStore:B,makeState:E,applyState:F,setState:H,makeGetters:L,setGetters:V,makeActions:q,setActions:K,makeWatchers:Q,setWatchers:R,exists:U,remove:X,reset:Y,run:Z,has:ee,get:te,getter:se,set:re,setter:ne,sync:oe,setFeature:ae,mapMethods:ce,getTeddy:ie,useTeddy:pe,getStore:ue,useStore:le,provideTeddyStore:de,injectTeddy:fe,injectTeddyStore:ye,computed:he});const ge=e=>{e.prototype.$teddy=me};export{C as Teddies,W as Teddy,z as TeddyStore,x as accessors,F as applyState,he as computed,U as exists,w as features,te as get,ue as getStore,ie as getTeddy,se as getter,ee as has,fe as injectTeddy,ye as injectTeddyStore,ge as install,q as makeActions,L as makeGetters,E as makeState,Q as makeWatchers,ce as mapMethods,de as provideTeddyStore,X as remove,Y as reset,Z as run,re as set,K as setActions,ae as setFeature,V as setGetters,H as setState,B as setStore,R as setWatchers,ne as setter,oe as sync,le as useStore,pe as useTeddy};
