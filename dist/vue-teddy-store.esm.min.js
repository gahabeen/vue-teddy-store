/*!
  * vue-teddy-store v0.2.61
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.2.61
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
import e,{reactive as t,isRef as s,set as r,unref as n,ref as a,provide as o,inject as c,computed as i,watch as p}from"@vue/composition-api";import{isObject as u,makeSet as f,makeHas as d,makeGet as l,makeRemove as y,isValidKey as h}from"object-string-path";import m from"vue";import g from"fast-deep-equal";const v=(e,t)=>`teddy:${e}:${t}`;var S={store(e,t){const s=ye({space:e,name:t});if(s.features.cache)return;const r=window.localStorage||global.localStorage||{};if(r){const n=r.getItem(v(e,t));n&&(s.state=JSON.parse(n)),Z({space:e,name:t},{handler(s){r.setItem(v(e,t),JSON.stringify(s))},immediate:!0,deep:!0}),s.features.cache=!0}}},P={store(e,s){const r=ye({space:e,name:s});r.features.history||(r.features.history={},r.features.history.stack=t([]),Z({space:e,name:s},{handler(e){r.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),r.features.history.installed=!0)}},w={store(e,t){const s=ye({space:e,name:t});s.features.sync||(s.features.sync={},window&&window.addEventListener("storage",r=>{r.key===v(e,t)&&(s.state={...s.state,...JSON.parse(r.newValue)})}),s.features.sync.installed=!0)}},_=Object.freeze({__proto__:null,cache:S,history:P,sync:w});function b(e){if(!u(e)||u(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}function k(e,t,a){if(u(e)||Array.isArray(e)){if(h(t))return s(e)?r(e.value,t,a):r(e,t,a),n(e)[t];s(e)?e.value=a:e=a}}function j(e,t){if(u(e)||Array.isArray(e))return h(t)?s(e)?t in e.value?e.value[t]:void 0:e[t]:s(e)?e.value:e}function A(e,t){return!(!u(e)&&!Array.isArray(e))&&(!!h(t)&&(!!(b(e)&&e.value&&t in e.value)||(!(!e||!(t in e))||void 0)))}function O(e,t){const r=n(e),a=s(e);return Array.isArray(r)?(a?e.value.splice(+t,1):e.splice(+t,1),!0):!!u(r)&&(a?e.value=function(e,t=[]){return Object.keys(e).reduce((s,r)=>(t.includes(r)||(s[r]=e[r]),s),{})}(e.value,[t]):delete e[t],!0)}function G(e=[]){return"_state"!==e[0]?["_state",...e]:e}const T=f({setProp:k,getProp:j,hasProp:A,afterGetSteps:G}),$=d({getProp:j,hasProp:A,afterGetSteps:G}),W=()=>l({getProp:j,hasProp:A,afterGetSteps:G}),x=()=>y({getProp:j,hasProp:A,removeProp:O,afterGetSteps:G}),z=f({setProp:k,getProp:j,hasProp:A}),J=d({getProp:j,hasProp:A}),N=l({getProp:j,hasProp:A}),D=y({get:N,getProp:j,hasProp:A});var I=Object.freeze({__proto__:null,teddySet:T,teddyHas:$,teddyGet:W,teddyRemove:x,set:z,has:J,get:N,remove:D});m.use(e);const q=Symbol(),B=Symbol(),C={__options:{devtools:!0},spaces:{}},E="$",F="@",H=e=>{let t,s;if(u(e))t="space"in e?e.space:E,s="name"in e?e.name:F;else if("string"==typeof e)if(e.includes(".")){let[r,n]=e.split(".");t=r,s=n}else if(e.includes("/")){let[r,n]=e.split("/");t=r,s=n}else t=E,s=e;return"string"==typeof t&&(t=t.trim(),0===t.length&&(t=void 0)),"string"==typeof s&&(s=s.trim(),0===s.length&&(s=void 0)),{space:t,name:s}},L=(e,t)=>{const s=H(e);t=t||{};const r=ye(s);return V(s,t.state),Q(s,t.getters),X(s,t.actions),Z(s,t.watchers),r},M=(e,t)=>s(t)?t:a(t),R=(e,t,s={})=>(s._state=M(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),V=(e,t)=>{const s=ye(e);R(0,t,s)},K=(e,t)=>{const s=ye(e);return t=t||{},Object.keys(t).reduce((e,r)=>(b(t[r])?e[r]=t[r]:"function"==typeof t[r]&&(e[r]=Se(()=>t[r](s))),e),{})},Q=(e,t)=>{const s=ye(e);return s.getters={...s.getters||{},...K(e,t)},s},U=(e,t)=>{const s=ye(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},X=(e,t)=>{const s=ye(e);return s.actions={...s.actions||{},...U(e,t)},s},Y=(e,t)=>{const{space:s,name:r}=H(e),n=ye(e),a=[];return Array.isArray(t)?a.push(...t):t&&a.push(t),0===a.length?[]:a.reduce((e,t)=>{const s=e=>function(t,s){e.call(this,t,s,g(t,s))},a=(e="",t)=>`${e}||${t.toString()}`,o=(t,r,n,o)=>{e.push({path:t,signature:a(t,n),options:o,start(){return this.unwatch=p(r,s(n),{deep:!0,...o}),this}})};if("function"==typeof t)o("state",()=>n.state,t,{deep:!0});else if(t&&"object"==typeof t&&"handler"in t){const{handler:e,path:s,paths:a=[],...c}=t;"string"==typeof s?o(s,()=>W()(n,s),e,{deep:!0,...c}):a.length>0?o(a.map(e=>[r,e].filter(Boolean).filter(e=>e.length>0).join(".")),a.map(e=>()=>W()(n,e)),e,{deep:!0,...c}):o("state",()=>n.state,e,{deep:!0,...c})}return e},[])},Z=(e,t)=>{const s=ye(e);for(const r of Y(e,t)){const e=s.watchers.find(e=>{const t=e.path===r.path,s=e.signature===r.signature;return t&&s});e&&e.unwatch(),s.watchers.push(r.start())}return s},ee=e=>{const{space:t,name:s}=H(e);return void 0!==s?t in C.spaces&&"stores"in C.spaces[t]&&s in C.spaces[t].stores:t in C.spaces},te=e=>{},se=(e,t,...s)=>{const{store:r}=he(e);if(t in r.actions)try{return r.actions[t](...s)}catch(e){console.error(`Something went wrong with the action '${t}'`),console.error(e)}else console.warn(`Couldn't find the action '${t}' to run.`)},re=(e,t,s)=>{const{space:r,name:n}=H(e),a=ye({space:r,name:n});return x()(a,t,s)},ne=(e,t,s)=>{const r=ye(e);return $(r,t,s)},ae=(e,t,s,r)=>{const{space:n,name:a}=H(e),o=ye({space:n,name:a});return W()(o,t,s)||r},oe=(e,t,s,r)=>function(){return ae(e,t,s||this,r)},ce=(e,t,s,r)=>{const n=ye(e);T(n,t,s,r)},ie=(e,t,s)=>function(r){ce(e,t,r,s||this)},pe=(e,t,s)=>{const r=(t,s)=>({get:oe(e,t,s),set:ie(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=r(t,s),e),{}):u(t)?Object.keys(t).reduce((e,n)=>(e[n]=r(t[n],s),e),{}):r(t,s)},ue=(e={})=>{"function"==typeof e.teddy&&e.teddy(C);for(const t of Object.keys(C.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(C.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},fe=(e=(e=>e))=>({setStore:e(L),makeState:e(M),setState:e(V),applyState:e(R),makeGetters:e(K),setGetters:e(Q),makeActions:e(U),setActions:e(X),makeWatchers:e(Y),setWatchers:e(Z),exists:e(ee),reset:e(te),run:e(se),remove:e(re),has:e(ne),get:e(ae),getter:e(oe),set:e(ce),setter:e(ie),sync:e(pe)}),de=(e=E)=>(e in C.spaces||(C.spaces[e]={}),C.spaces[e]),le=(e=E)=>({store:de(e),...fe(t=>(...s)=>t({space:e,name:F},...s))}),ye=e=>{const{space:t=E,name:s=F}=H(e);return de(t),"stores"in C.spaces[t]||(C.spaces[t].stores={}),s in C.spaces[t].stores||(C.spaces[t].stores[s]={getters:{},actions:{},watchers:[],options:{},features:{}},R(0,{},C.spaces[t].stores[s])),C.spaces[t].stores[s]},he=e=>({store:ye(e),...fe(t=>(...s)=>t(e,...s))}),me=e=>{o(B,he(e))},ge=()=>{c(q)},ve=()=>{c(B)},Se=e=>{if(u(e)){const t="get"in e&&"function"==typeof e.get,s="set"in e&&"function"==typeof e.set;return t||s?i(e):Object.keys(e).reduce((t,s)=>(t[s]=i(e[s]),t),{})}return i(e)};var Pe=Object.freeze({__proto__:null,accessors:I,features:_,Teddy:q,TeddyStore:B,Teddies:C,setStore:L,makeState:M,applyState:R,setState:V,makeGetters:K,setGetters:Q,makeActions:U,setActions:X,makeWatchers:Y,setWatchers:Z,exists:ee,reset:te,run:se,remove:re,has:ne,get:ae,getter:oe,set:ce,setter:ie,sync:pe,setFeature:ue,mapMethods:fe,getTeddy:de,useTeddy:le,getStore:ye,useStore:he,provideTeddyStore:me,injectTeddy:ge,injectTeddyStore:ve,computed:Se});const we=e=>{e.prototype.$teddy=Pe};export{C as Teddies,q as Teddy,B as TeddyStore,I as accessors,R as applyState,Se as computed,ee as exists,_ as features,ae as get,ye as getStore,de as getTeddy,oe as getter,ne as has,ge as injectTeddy,ve as injectTeddyStore,we as install,U as makeActions,K as makeGetters,M as makeState,Y as makeWatchers,fe as mapMethods,me as provideTeddyStore,re as remove,te as reset,se as run,ce as set,X as setActions,ue as setFeature,Q as setGetters,V as setState,L as setStore,Z as setWatchers,ie as setter,pe as sync,he as useStore,le as useTeddy};
