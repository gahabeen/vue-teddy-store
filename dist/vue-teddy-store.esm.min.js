/*!
  * vue-teddy-store v0.2.7
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
/*!
  * vue-teddy-store v0.2.7
  * (c) 2020 Gabin Desserprit
  * @license MIT
  */
import e,{reactive as t,unref as s,isRef as r,ref as o,provide as n,inject as a,computed as c,watch as i}from"@vue/composition-api";import{isObject as p,makeSet as u,makeHas as f,makeGet as l,makeRemove as h,makePush as d,makeUnshift as y,isValidKey as g}from"object-string-path";import m from"vue";import v from"fast-deep-equal";const P=(e,t)=>`teddy:${e}:${t}`;var S={store(e,t){const s=we({space:e,name:t});if(s.features.cache)return;const r=window.localStorage||global.localStorage||{};if(r){const o=r.getItem(P(e,t));o&&(s.state=JSON.parse(o)),ae({space:e,name:t},{handler(s){r.setItem(P(e,t),JSON.stringify(s))},immediate:!0,deep:!0}),s.features.cache=!0}}},b={store(e,s){const r=we({space:e,name:s});r.features.history||(r.features.history={},r.features.history.stack=t([]),ae({space:e,name:s},{handler(e){r.features.history.stack.push({state:e,ts:(new Date).getTime()})},immediate:!0,deep:!0}),r.features.history.installed=!0)}},A={store(e,t){const s=we({space:e,name:t});s.features.sync||(s.features.sync={},window&&window.addEventListener("storage",r=>{r.key===P(e,t)&&(s.state={...s.state,...JSON.parse(r.newValue)})}),s.features.sync.installed=!0)}},w=Object.freeze({__proto__:null,cache:S,history:b,sync:A});function _(e){if(!p(e)||p(e)&&!("value"in e))return!1;return"function"==typeof Object.getOwnPropertyDescriptor(e,"value").get}const k=Array.isArray;function j(e,t,o){const n=s(e),a=r(e);k(n)&&function(e){const t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}(t)?(n.length=Math.max(n.length,t),a?e.value.splice(t,1,o):e.splice(t,1,o)):g(t)&&p(n)?a?e.value[t]=o:e[t]=o:a?e.value=o:e=o}function O(e,t){if(p(e)||Array.isArray(e))return g(t)?r(e)?t in e.value?e.value[t]:void 0:e[t]:r(e)?e.value:e}function G(e,t){return!(!p(e)&&!Array.isArray(e))&&(!!g(t)&&(!!(_(e)&&e.value&&t in e.value)||(!(!e||!(t in e))||void 0)))}function T(e,t){const o=s(e),n=r(e);if(console.log({target:e,value:t}),Array.isArray(o))return n?(e.value.push(t),e.value.slice(-1)[0]):(e.push(t),e.slice(-1)[0])}function x(e,t){const o=s(e),n=r(e);if(Array.isArray(o))return n?(e.value.unshift(t),e.value[0]):(e.unshift(t),e[0])}function $(e=[]){return"_state"!==e[0]?["_state",...e]:e}const W=u({setProp:j,getProp:O,hasProp:G,afterGetSteps:$}),z=f({getProp:O,hasProp:G,afterGetSteps:$}),F=l({getProp:O,hasProp:G,afterGetSteps:$}),J=h({getProp:O,hasProp:G,removeProp:function(e,t){const o=s(e),n=r(e);return Array.isArray(o)?(n?e.value.splice(+t,1):e.splice(+t,1),!0):!!p(o)&&(n?e.value=function(e,t=[]){return Object.keys(e).reduce((s,r)=>(t.includes(r)||(s[r]=e[r]),s),{})}(e.value,[t]):delete e[t],!0)},afterGetSteps:$}),M=d({getProp:O,hasProp:G,pushProp:T,afterGetSteps:$}),N=y({getProp:O,hasProp:G,unshiftProp:x,afterGetSteps:$}),D=u({setProp:j,getProp:O,hasProp:G}),I=f({getProp:O,hasProp:G}),q=l({getProp:O,hasProp:G}),B=h({getProp:O,hasProp:G}),C=d({getProp:O,hasProp:G,pushProp:T}),E=y({getProp:O,hasProp:G,unshiftProp:x});var H=Object.freeze({__proto__:null,teddySet:W,teddyHas:z,teddyGet:F,teddyRemove:J,teddyPush:M,teddyUnshift:N,set:D,has:I,get:q,remove:B,push:C,unshift:E});m.use(e);const L=Symbol(),R=Symbol(),U={__options:{devtools:!0},spaces:{}},V="$",K="@",Q=e=>{let t,s;if(p(e))t="space"in e?e.space:V,s="name"in e?e.name:K;else if("string"==typeof e)if(e.includes(".")){let[r,o]=e.split(".");t=r,s=o}else if(e.includes("/")){let[r,o]=e.split("/");t=r,s=o}else t=V,s=e;return"string"==typeof t&&(t=t.trim(),0===t.length&&(t=void 0)),"string"==typeof s&&(s=s.trim(),0===s.length&&(s=void 0)),{space:t,name:s}},X=(e,t)=>{const s=Q(e);t=t||{};const r=we(s);return ee(s,t.state),se(s,t.getters),oe(s,t.actions),ae(s,t.watchers),r},Y=(e,t)=>r(t)?t:o(t),Z=(e,t,s={})=>(s._state=Y(0,t),"state"in s||Object.defineProperty(s,"state",{get:()=>s._state.value,set:e=>{s._state.value=e},enumerable:!0}),s),ee=(e,t)=>{const s=we(e);Z(0,t,s)},te=(e,t)=>{const s=we(e);return t=t||{},Object.keys(t).reduce((e,r)=>(_(t[r])?e[r]=t[r]:"function"==typeof t[r]&&(e[r]=Ge(()=>t[r](s))),e),{})},se=(e,t)=>{const s=we(e);return s.getters={...s.getters||{},...te(e,t)},s},re=(e,t)=>{const s=we(e);return t=t||{},Object.keys(t).reduce((e,r)=>("function"==typeof t[r]&&(e[r]=(...e)=>t[r](s,...e)),e),{})},oe=(e,t)=>{const s=we(e);return s.actions={...s.actions||{},...re(e,t)},s},ne=(e,t)=>{const{name:s}=Q(e),r=we(e),o=[];return Array.isArray(t)?o.push(...t):t&&o.push(t),0===o.length?[]:o.reduce((e,t)=>{const o=(e,t=null)=>{const s=function(t,s){e.call(this,t,s,v(t,s))};return"number"==typeof t?function(e,t=100){let s;return function(...r){clearTimeout(s),s=setTimeout(()=>{e.apply(this,r)},t)}}(s,t):s},n=(e="",t)=>`${e}||${t.toString()}`,a=(t,s,r,a={})=>{e.push({path:t,signature:n(t,r),options:a,start(){return this.unwatch=i(s,o(r,a.debounce),{deep:!0,...a}),this}})};if("function"==typeof t)a("state",()=>r.state,t,{deep:!0});else if(t&&"object"==typeof t&&"handler"in t){const{handler:e,path:o,paths:n=[],...c}=t;"string"==typeof o?a(o,()=>F(r,o),e,{deep:!0,...c}):n.length>0?a(n.map(e=>[s,e].filter(Boolean).filter(e=>e.length>0).join(".")),n.map(e=>()=>F(r,e)),e,{deep:!0,...c}):a("state",()=>r.state,e,{deep:!0,...c})}return e},[])},ae=(e,t)=>{const s=we(e);for(const r of ne(e,t)){const e=s.watchers.find(e=>{const t=e.path===r.path,s=e.signature===r.signature;return t&&s});e&&e.unwatch(),s.watchers.push(r.start())}return s},ce=e=>{const{space:t,name:s}=Q(e);return void 0!==s?t in U.spaces&&"stores"in U.spaces[t]&&s in U.spaces[t].stores:t in U.spaces},ie=e=>{},pe=(e,t,...s)=>{const{store:r}=_e(e);if(t in r.actions)try{return r.actions[t](...s)}catch(e){console.error(`Something went wrong with the action '${t}'`),console.error(e)}else console.warn(`Couldn't find the action '${t}' to run.`)},ue=(e,t,s)=>{m.config.devtools&&console.log("remove()",{definition:e,path:t,context:s});const{space:r,name:o}=Q(e),n=we({space:r,name:o});return J(n,t,s)},fe=(e,t,s)=>{const r=we(e);return z(r,t,s)},le=(e,t,s,r)=>{const{space:o,name:n}=Q(e),a=we({space:o,name:n});return F(a,t,s)||r},he=(e,t,s,r)=>function(){return le(e,t,s||this,r)},de=(e,t,s,r)=>{m.config.devtools&&console.log("set()",{definition:e,path:t,value:s,context:r});const o=we(e);W(o,t,s,r)},ye=(e,t,s)=>function(r){de(e,t,r,s||this)},ge=(e,t,s,r)=>{m.config.devtools&&console.log("push()",{definition:e,path:t,value:s,context:r});const o=we(e);M(o,t,s,r)},me=(e,t,s,r)=>{m.config.devtools&&console.log("unshift()",{definition:e,path:t,value:s,context:r});const o=we(e);N(o,t,s,r)},ve=(e,t,s)=>{const r=(t,s)=>({get:he(e,t,s),set:ye(e,t,s)});return Array.isArray(t)?t.reduce((e,t)=>(e[t]=r(t,s),e),{}):p(t)?Object.keys(t).reduce((e,o)=>(e[o]=r(t[o],s),e),{}):r(t,s)},Pe=(e={})=>{"function"==typeof e.teddy&&e.teddy(U);for(const t of Object.keys(U.spaces||{})){"function"==typeof e.space&&e.space(t);for(const s of Object.keys(U.spaces[t].stores||{}))"function"==typeof e.store&&e.store(t,s)}},Se=(e=(e=>e))=>({setStore:e(X),makeState:e(Y),setState:e(ee),applyState:e(Z),makeGetters:e(te),setGetters:e(se),makeActions:e(re),setActions:e(oe),makeWatchers:e(ne),setWatchers:e(ae),exists:e(ce),reset:e(ie),run:e(pe),remove:e(ue),has:e(fe),get:e(le),getter:e(he),set:e(de),setter:e(ye),sync:e(ve),push:e(ge),unshift:e(me)}),be=(e=V)=>(e in U.spaces||(U.spaces[e]={}),U.spaces[e]),Ae=(e=V)=>({store:be(e),...Se(t=>(...s)=>t({space:e,name:K},...s))}),we=e=>{const{space:t=V,name:s=K}=Q(e);return be(t),"stores"in U.spaces[t]||(U.spaces[t].stores={}),s in U.spaces[t].stores||(U.spaces[t].stores[s]={getters:{},actions:{},watchers:[],options:{},features:{}},Z(0,{},U.spaces[t].stores[s])),U.spaces[t].stores[s]},_e=e=>({store:we(e),...Se(t=>(...s)=>t(e,...s))}),ke=e=>{n(R,_e(e))},je=()=>{a(L)},Oe=()=>{a(R)},Ge=e=>{if(p(e)){const t="get"in e&&"function"==typeof e.get,s="set"in e&&"function"==typeof e.set;return t||s?c(e):Object.keys(e).reduce((t,s)=>(t[s]=c(e[s]),t),{})}return c(e)};var Te=Object.freeze({__proto__:null,accessors:H,features:w,Teddy:L,TeddyStore:R,Teddies:U,setStore:X,makeState:Y,applyState:Z,setState:ee,makeGetters:te,setGetters:se,makeActions:re,setActions:oe,makeWatchers:ne,setWatchers:ae,exists:ce,reset:ie,run:pe,remove:ue,has:fe,get:le,getter:he,set:de,setter:ye,push:ge,unshift:me,sync:ve,setFeature:Pe,mapMethods:Se,getTeddy:be,useTeddy:Ae,getStore:we,useStore:_e,provideTeddyStore:ke,injectTeddy:je,injectTeddyStore:Oe,computed:Ge});const xe=e=>{e.prototype.$teddy=Te};export{U as Teddies,L as Teddy,R as TeddyStore,H as accessors,Z as applyState,Ge as computed,ce as exists,w as features,le as get,we as getStore,be as getTeddy,he as getter,fe as has,je as injectTeddy,Oe as injectTeddyStore,xe as install,re as makeActions,te as makeGetters,Y as makeState,ne as makeWatchers,Se as mapMethods,ke as provideTeddyStore,ge as push,ue as remove,ie as reset,pe as run,de as set,oe as setActions,Pe as setFeature,se as setGetters,ee as setState,X as setStore,ae as setWatchers,ye as setter,ve as sync,me as unshift,_e as useStore,Ae as useTeddy};
